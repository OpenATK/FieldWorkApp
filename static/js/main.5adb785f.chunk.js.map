{"version":3,"sources":["serviceWorker.js","config/index.js","overmind/view/Login/index.js","overmind/view/Login/state.js","overmind/view/Login/actions.js","overmind/view/FieldDetails/state.js","overmind/app/OADAManager/tree.js","overmind/view/FieldDetails/index.js","overmind/view/FieldDetails/actions.js","overmind/view/FieldList/index.js","overmind/view/FieldList/state.js","overmind/view/FieldList/actions.js","overmind/view/Map/state.js","overmind/view/Map/actions.js","overmind/view/Map/BoundaryDrawing/index.js","overmind/view/Map/BoundaryDrawing/state.js","overmind/view/Map/BoundaryDrawing/actions.js","overmind/view/Map/index.js","overmind/view/Modals/state.js","overmind/view/Modals/actions.js","overmind/view/Modals/SaveField/actions.js","overmind/view/Modals/SaveField/index.js","overmind/view/Modals/SaveField/state.js","overmind/view/Modals/NewOperation/actions.js","overmind/view/Modals/NewOperation/index.js","overmind/view/Modals/NewOperation/state.js","overmind/view/Modals/NewFarm/actions.js","overmind/view/Modals/NewFarm/index.js","overmind/view/Modals/NewFarm/state.js","overmind/view/Modals/index.js","overmind/view/TopBar/actions.js","overmind/view/TopBar/OperationDropdown/index.js","overmind/view/TopBar/OperationDropdown/state.js","overmind/view/TopBar/OperationDropdown/actions.js","overmind/view/TopBar/index.js","overmind/view/TopBar/state.js","overmind/view/index.js","overmind/view/state.js","overmind/view/actions.js","overmind/app/test/testFields.js","overmind/app/test/testFarms.js","overmind/app/state.js","overmind/app/actions.js","overmind/app/OADAManager/state.js","overmind/app/OADAManager/actions.js","overmind/app/OADAManager/index.js","overmind/app/index.js","overmind/index.js","view/Login/index.js","view/Map/BoundaryDrawing/index.js","view/Map/Fields/index.js","view/Map/index.js","view/TopBar/DrawingToolbar/index.js","view/TopBar/NormalToolbar/OperationDropdown/index.js","view/TopBar/NormalToolbar/MoreDropdown/index.js","view/TopBar/NormalToolbar/MyLocation/index.js","view/TopBar/NormalToolbar/MyLocation/Button.js","view/TopBar/NormalToolbar/index.js","view/TopBar/index.js","view/FieldList/index.js","view/FieldDetails/index.js","view/AcresStatus/AcresPlanned/index.js","view/AcresStatus/AcresStarted/index.js","view/AcresStatus/AcresDone/index.js","view/AcresStatus/index.js","view/Modals/SaveField.js","view/Modals/OADADomain.js","view/Modals/NewOperation.js","view/Modals/NewFarm.js","view/App.js","index.js","../../../oada-cache-overmind/index.js","view/logo.svg","../../../oada-cache-overmind/state.js","../../../oada-cache-overmind/actions.js","../../../oada-cache-overmind/effects.js","../../../oada-cache/src/index.js","../../../oada-cache/src/cache.js","../../../oada-cache/src/websocket.js","../../../oada-cache/src/token.js"],"names":["Boolean","window","location","hostname","match","METADATA","REDIRECT","OPTIONS","redirect","metadata","scope","SCOPE","oadaDomain","state","domain","config","actions","onInitialize","localStorage","token","view","Login","login","myState","loading","app","OADAManager","connected","loggedIn","logout","domainChange","data","value","viewDemo","open","fieldId","_","get","field","selectedFieldId","operation","status","currentConnection","acres","geojsonArea","geometry","boundary","merge","farm","farmId","id","showAddOperationButton","isEmpty","bookmarks","_type","_rev","fields","farms","seasons","operations","_state","FieldDetails","close","changeOADAFieldStatus","operationId","clone","newStatus","unset","requests","type","path","oada","delete","connection_id","set","tree","_id","put","changeLocalFieldStatus","onStatusChange","myActions","onAddNewOperationClick","TopBar","OperationDropdown","onAdd","selectedField","fieldStyles","editingField","center","zoom","bounds","fieldsToRender","chain","mapValues","styledField","style","color","fillColor","omitBy","v","k","zoomTo","latitude","longitude","Promise","delay","styleField","highlight","weight","unhighlight","unselectField","onFieldClick","onMapClick","props","BoundaryDrawing","zoomBounds","compact","map","f","geo","featureCollection","GeoJSON","parse","BBox","drawing","addPointToBoundary","Map","uuid","lat","lng","updateBoundaryPoint","pipe","debounce","mutate","latlng","onMarkerMove","onStartDrawing","onStopDrawing","_actions","OADADomain","Modals","onConnectClick","onDomainChange","onConnect","onDomainChanged","onCancel","convertToGEOJSON","points","coordinates","p","length","push","getChanges","newBoundary","farm_id","seasonFarm_id","SaveField","seasonField","getSeasonField","newName","name","seasonFieldChanges","fieldChanges","isEqual","cloneDeep","saveChangesToLocalData","editingFieldId","fieldPath","seasonFieldPath","saveChangesToOADA","context","a","console","log","createField","addFieldToLocalData","year","addFieldToOADA","farmSearch","search","seasonFarms","toLowerCase","key","text","saveField","onSave","onNameChange","onFarmSearchChange","onFarmChange","onFarmAdd","NewFarm","callbackAction","onFarmAddComplete","addOperationToLocalData","addOperationToOADA","ret","substr","NewOperation","saveOperation","addFarmToLocalData","addFarmToOADA","saveFarm","action","onMyLocationClick","coords","onLocationChange","onAddField","onSaveField","onCancelField","onEditField","currentField","coors","pop","forEach","onResetCache","resetCache","onLogout","selected","list","label","empty","circular","o","startsWith","selectedOperationId","selectedId","keys","selectedOperation","onChange","onOpenChange","onSearch","FieldList","acresStatus","operationFields","seasonFields","planned","started","done","fieldOperation","area","total","Math","round","plannedPercentage","startedPercentage","donePercentage","currentOADA","oadaOrgData","oadaSeasonFarmsIdBy_id","isNull","mapKeys","oadaSeasonFarms_idByFarm_id","localOrgData","localData","abc123","organizations","testFields","testFarms","getSeasonFarm","user","getAccessToken","promisify","oadaIdClient","getToken","replace","res","access_token","connect","effects","options","cache","then","response","error","connectionId","disconnect","getUserInfo","fetchAndWatch","watchRequests","watch","onFieldChanged","onSeasonsChanged","rewatchRequests","responses","initSeasonFields","fieldsChanged","obj","changeSeasonFields","initSeasonFarms","changed","changeSeasonFarms","theSeasonFields","fieldChange","seasonFarmId","change","seasonFarm","deleteSeasonFields","deleted","deleteSeasonFarms","changeType","wasDelete","fieldsDeleted","farmsChanged","farmsDeleted","warn","oadaCacheOvermind","namespaced","createHook","overmind","css","height","src","alt","Form","onSubmit","Input","placeholder","evt","Button","marginTop","primary","disabled","onClick","LayerGroup","Polygon","positions","Marker","position","draggable","onMove","oldLatLng","Fields","bubblingMouseEvents","zoomControl","TileLayer","url","attribution","minZoom","maxZoom","DrawingToolbar","Toolbar","View","flex","OperationsDropdown","flexDirection","Dropdown","onOpen","onBlur","icon","floating","labeled","button","className","Menu","top","Item","textAlign","iconPosition","target","scrolling","option","MoreDropdown","React","useState","anchorEl","setAnchorEl","handleClose","IconButton","edge","aria-label","event","currentTarget","right","keepMounted","onClose","MenuItem","geolocated","positionOptions","enableHighAccuracy","userDecisionTimeout","isGeolocationAvailable","isGeolocationEnabled","useEffect","NormalToolbar","toggleTitle","zIndex","AppBar","TemporaryDrawer","Drawer","variant","width","role","List","index","ListItem","ListItemIcon","ListItemText","Divider","onEditFieldClick","anchor","paddingBottom","alignItems","justifyContent","Text","fontWeight","fontSize","marginLeft","marginBottom","FormControl","component","FormGroup","row","FormControlLabel","control","Checkbox","checked","labelPlacement","AcresPlanned","backgroundColor","paddingLeft","paddingRight","paddingTop","borderRadius","textShadowColor","textShadowOffset","textShadowRadius","AcresStarted","marginRight","AcresDone","AcresStatus","display","farmOpen","setFarmOpen","farmOptions","Modal","size","Header","Content","autoFocus","trigger","border","Icon","overflow","maxHeight","Actions","negative","positive","labelPosition","content","App","createOvermind","devtools","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister","Object","defineProperty","exports","default","namespace","_effects","_interopRequireDefault","require","__esModule","module","connections","_namespace","ns","domainToConnectionId","websocket","isAuthenticated","catch","message","handleWatch","nullPath","split","shift","join","currentState","_lodash","concat","_oldState","body","deletePath","oldState","_deletePath","Error","concurrent","_bluebird","mapSeries","request","i","complete","_statePath","conn","watches","payload","headers","_responseData","arguments","source","ownKeys","_defineProperty","getOwnPropertyDescriptors","defineProperties","getOwnPropertyDescriptor","_objectSpread","newState","post","unwatch","_url","object","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","enumerable","apply","configurable","writable","domainUrl","_oadaCache","_default","args","resolve","func","connection","undefined","setupCache","urlLib","pointer","ws","axios","_TOKEN","info","dbprefix","process","on","reason","_replaceLinks","_makeResourceAndLink","_watch","_buildRequest","_sendRequest","_treeWalk","_recursiveFilterChange","_recursiveGet","_findDeepestResources","_convertSetupTreePath","_ensureTree","_configureCache","_recursiveDelete","del","reconnect","_getMemoryCache","CACHE","_token","renew","TOKEN","db","SOCKET","cleanUp","expires","method","req","pieces","treePath","has","result","subTree","link","got","removeLookup","DOMAIN","REQUEST","api","firstPath","storedTree","parentRev","slice","stored","piece","j","urlPath","setup","resp","resource","pathPieces","newPieces","z","err","test","cached","function","callback","watchResponse","dataOut","rv","beforeCb","afterCb","bef","nextTree","indexOf","authorization","header","requestStack","stack","watchPayload","handleWatchChange","waitTime","linkReq","resReq","parentPath","splice","NOCACHEREQUEST","Authorization","newHeaders","parseInt","Array","isArray","val","NAME","EXPIRES","socketApi","http","setDbPrefix","pfx","cq","PouchDB","memoryCache","cancellation","dbName","expiration","handleMemoryCache","resourceId","now","Date","access","valid","promise","putPending","doPut","doc","rev","dbUpsert","urlObj","pathLeftover","dbPut","accessed","memoryResult","INCOMPLETE_RESOURCE","cancel","remove","curData","newData","getResFromServer","getLookup","res_inmemory","headReq","getResFromDb","offline","revLimit","res_localdb","newReq","lookup","protocol","host","reqPieces","updateParent","replaceLinks","_meta","_recursiveUpsert","newBody","charAt","findNullValue","concurrency","findDeepestResource","deepestResource","setInterval","oldest","time","deleteCount","queue","limit","deletedPath","destroy","WebSocket","warnings","messages","socket","httpCallbacks","watchCallbacks","sendMessages","send","JSON","stringify","reject","onopen","oncloconsose","onmessage","requestId","statusText","originalStack","entries","reduce","b","STATUS_CODE","crypto","Token","param","self","this","_domain","_options","_dbprefix","hash","createHash","update","_name","digest","_isSet","_tokenDB","_expired","isSet","checkTokenDB","node","gat"],"mappings":"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","file":"static/js/main.5adb785f.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","const SCOPE = 'oada.yield:all';\nconst OPENATK_METADATA = 'eyJqa3UiOiJodHRwczovL2lkZW50aXR5Lm9hZGEtZGV2LmNvbS9jZXJ0cyIsImtpZCI6ImtqY1NjamMzMmR3SlhYTEpEczNyMTI0c2ExIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJyZWRpcmVjdF91cmlzIjpbImh0dHA6Ly9vcGVuYXRrLmNvbS9GaWVsZFdvcmtBcHAvb2F1dGgyL3JlZGlyZWN0Lmh0bWwiLCJodHRwOi8vbG9jYWxob3N0L29hdXRoMi9yZWRpcmVjdC5odG1sIl0sInRva2VuX2VuZHBvaW50X2F1dGhfbWV0aG9kIjoidXJuOmlldGY6cGFyYW1zOm9hdXRoOmNsaWVudC1hc3NlcnRpb24tdHlwZTpqd3QtYmVhcmVyIiwiZ3JhbnRfdHlwZXMiOlsiYXV0aG9yaXphdGlvbl9jb2RlIl0sInJlc3BvbnNlX3R5cGVzIjpbInRva2VuIiwiY29kZSIsImlkX3Rva2VuIiwiaWRfdG9rZW4gdG9rZW4iLCJjb2RlIGlkX3Rva2VuIiwiY29kZSB0b2tlbiIsImNvZGUgaWRfdG9rZW4gdG9rZW4iXSwiY2xpZW50X25hbWUiOiJPcGVuQVRLIiwiY2xpZW50X3VyaSI6Imh0dHA6Ly9vcGVuYXRrLmNvbSIsImNvbnRhY3RzIjpbIlNhbSBOb2VsIDxzYW5vZWxAcHVyZHVlLmVkdT4iXSwiandrcyI6eyJrZXlzIjpbeyJrdHkiOiJSU0EiLCJuIjoiemF1WkZCdU1kbHYxa1lqelViNHEtXzNtNHNtRnhuZnc0U1lvYUhxN2NpOFNjdFkzeGo3cmRBSHlrUXBuUVZyajZLTzhtYUh2LTBCdlc1TWhjZ2l2a3VZcy16SEV2ZllCZVZCbmN2SGdPa0pQYmM5MUN3X2l3T1k3RUhXQjhoTTdWaUxRVmNfRHYwaDhuSnliQnZoTDA0Q0hRdDdDcE10VllHNmZvSlhjM2RxNTJqTlFiQkhJWjVtN1Z6MUt0eXpvTGNwOE8ybWhhTHA0NVVyM0NfMWVHdHY4bjVOejliV19CaDVYRlliRHh2N0JuaFpOSXcxR0NiampBd210Ym5uTDdHZ2Y0Q3k2MHdSSG1SNHZvZTIxT0lqb0FTcTJqWjAzeDEybVhzN0hQSTNZQjR5Mjl3dlpNdzJnTHpPZFRvcnJxTy10bG1uMWJvUGtXS0pKU1hvQXZ3IiwiZSI6IkFRQUIifV19LCJzb2Z0d2FyZV9pZCI6ImE3MDNiZmRjLTNmYTEtNDk5Zi1iOTA1LTExZjBiNTRmMzgwNyIsInJlZ2lzdHJhdGlvbl9wcm92aWRlciI6Imh0dHBzOi8vaWRlbnRpdHkub2FkYS1kZXYuY29tIiwiaWF0IjoxNTMzODQ2MTEyfQ.Y9BlbqHzOvufADGAW9HG4Yx2rqbg6zPalpcjSS_97Mpg36lOuADGJ4YTQ2iQfRlZjzqBi1sUq3iFhReBfk89Oy2nSEY6RVPnONK5v6a73jce3xGPUWk8DDl3rf3lcrt-IqWFoAieUie7WK5nrPFIe-_xcgYdChnuGrugjO9dGOY';\nconst LOCALHOST_VIP_METADATA = 'eyJqa3UiOiJodHRwczovL2lkZW50aXR5Lm9hZGEtZGV2LmNvbS9jZXJ0cyIsImtpZCI6ImtqY1NjamMzMmR3SlhYTEpEczNyMTI0c2ExIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJyZWRpcmVjdF91cmlzIjpbImh0dHA6Ly92aXAzLmVjbi5wdXJkdWUuZWR1OjgwMDAvb2F1dGgyL3JlZGlyZWN0Lmh0bWwiLCJodHRwOi8vbG9jYWxob3N0OjgwMDAvb2F1dGgyL3JlZGlyZWN0Lmh0bWwiXSwidG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2QiOiJ1cm46aWV0ZjpwYXJhbXM6b2F1dGg6Y2xpZW50LWFzc2VydGlvbi10eXBlOmp3dC1iZWFyZXIiLCJncmFudF90eXBlcyI6WyJpbXBsaWNpdCJdLCJyZXNwb25zZV90eXBlcyI6WyJ0b2tlbiIsImlkX3Rva2VuIiwiaWRfdG9rZW4gdG9rZW4iXSwiY2xpZW50X25hbWUiOiJPcGVuQVRLIiwiY2xpZW50X3VyaSI6Imh0dHBzOi8vdmlwMy5lY24ucHVyZHVlLmVkdSIsImNvbnRhY3RzIjpbIlNhbSBOb2VsIDxzYW5vZWxAcHVyZHVlLmVkdT4iXSwic29mdHdhcmVfaWQiOiIxZjc4NDc3Zi0zNTQxLTQxM2ItOTdiNi04NjQ0YjRhZjViYjgiLCJyZWdpc3RyYXRpb25fcHJvdmlkZXIiOiJodHRwczovL2lkZW50aXR5Lm9hZGEtZGV2LmNvbSIsImlhdCI6MTUxMjAwNjc2MX0.AJSjNlWX8UKfVh-h1ebCe0MEGqKzArNJ6x0nmta0oFMcWMyR6Cn2saR-oHvU8WrtUMEr-w020mAjvhfYav4EdT3GOGtaFgnbVkIs73iIMtr8Z-Y6mDEzqRzNzVRMLghj7CyWRCNJEk0jwWjOuC8FH4UsfHmtw3ouMFomjwsNLY0';\nconst REDIRECT_LOCALHOST = 'http://localhost:8000/oauth2/redirect.html';\nconst REDIRECT_OPENATK = 'http://openatk.com/FieldWorkApp/oauth2/redirect.html';\n\nlet METADATA;\nlet REDIRECT;\nlet oadaDomain = '';\nif (process.env.NODE_ENV !== 'production') {\n  console.log('NODE_ENV = ', process.env.NODE_ENV);\n  METADATA = LOCALHOST_VIP_METADATA;\n  REDIRECT = REDIRECT_LOCALHOST;\n  oadaDomain = 'https://localhost';\n} else {\n  METADATA = OPENATK_METADATA;\n  REDIRECT = REDIRECT_OPENATK;\n}\n\nlet OPTIONS = {\n    redirect: REDIRECT,\n    metadata: METADATA,\n    scope: SCOPE\n};\n\nexport default {\n  OPTIONS,\n  REDIRECT,\n  METADATA,\n  SCOPE,\n  oadaDomain\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","import config from '../../../config'\nexport default {\n  domain: config.oadaDomain\n}\n","export default {\n  onInitialize({ state, actions }) {\n    const domain = window.localStorage['oada:domain'];\n    const token = window.localStorage['oada:token'];\n    if (domain) {\n      state.view.Login.domain = domain\n    }\n    if (domain && token) {\n      //Auto login\n      actions.view.Login.login({token});\n    }\n  },\n  async login({ state, actions }, {token}) {\n    const myState = state.view.Login;\n    let domain = myState.domain;\n    myState.loading = true;\n    domain = domain.match(/^http/) ? domain : 'https://'+myState.domain;\n    await actions.app.OADAManager.login({domain, token});\n    myState.loading = false;\n    if (state.app.OADAManager.connected) {\n      myState.loggedIn = true;\n      //Save domain and token\n      window.localStorage['oada:domain'] = myState.domain;\n      window.localStorage['oada:token'] = state.app.OADAManager.token;\n    }\n  },\n  async logout({ state, actions }) {\n    const myState = state.view.Login;\n    if (state.app.OADAManager.connected) {\n      await actions.app.OADAManager.logout();\n      delete window.localStorage['oada:domain']\n      delete window.localStorage['oada:token']\n    }\n    myState.loggedIn = false;\n  },\n  domainChange({ state }, data) {\n    const myState = state.view.Login;\n    myState.domain = data.value;\n  },\n  viewDemo({ state }, data) {\n    const myState = state.view.Login;\n    myState.loggedIn = true;\n  }\n}\n","import _ from 'lodash';\nimport geojsonArea from '@mapbox/geojson-area';\n\nexport default {\n  open: false,\n  fieldId: ({}, state) => {\n    return _.get(state, `view.Map.selectedField`);\n  },\n  field: ({fieldId: selectedFieldId}, state) => {\n    const operation = _.get(state, `view.TopBar.OperationDropdown.selectedOperation`);\n    if (selectedFieldId == null) return null;\n    const status = _.get(operation, `fields.${selectedFieldId}.status`, null);\n    let field = null;\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      field = _.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.fields.${selectedFieldId}`); //TODO year\n    } else {\n      field = _.get(state, `app.localData.abc123.seasons.2019.fields.${selectedFieldId}`); //TODO year, organization\n    }\n    if (field == null) return null;\n    const acres = geojsonArea.geometry(field.boundary) * 0.000247105 //Meters to acres;\n    return _.merge({}, field, {status, acres});\n  },\n  farm: ({field}, state) => {\n    //Get farm for selected field\n    let farm = null;\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      if (_.get(field, 'farm._id')) {\n        const farmId = _.get(state, `app.oadaSeasonFarmsIdBy_id.${_.get(field, 'farm._id')}.id`)\n        farm = _.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.farms.${farmId}`); //TODO year\n      }\n    } else {\n      if (_.get(field, 'farm.id')) {\n        farm = _.get(state, `app.localData.abc123.seasons.2019.farms.${field.farm.id}`); //TODO year, organization\n      }\n    }\n    return farm;\n  },\n  showAddOperationButton: ({}, state) => {\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      return _.isEmpty(_.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.operations`)); //TODO year\n    } else {\n      return _.isEmpty(_.get(state, `app.localData.abc123.seasons.2019.operations`)); //TODO year\n    }\n  }\n}\n","export default {\n  bookmarks: {\n    _type: \"application/vnd.oada.bookmarks.1+json\",\n    _rev: 0,\n    fields: {\n      _type: \"application/vnd.oada.fields.1+json\",\n      _rev: 0,\n      fields: {\n        \"*\": {\n          _type: \"application/vnd.oada.field.1+json\",\n          _rev: 0,\n          farm: {\n            _type: \"application/vnd.oada.farm.1+json\",\n          }\n        }\n      },\n      farms: {\n        \"*\": {\n          _type: \"application/vnd.oada.farm.1+json\",\n          _rev: 0\n        }\n      }\n    },\n    seasons: {\n      _type: \"application/vnd.oada.seasons.1+json\",\n      _rev: 0,\n      \"*\": {\n        _type: \"application/vnd.oada.season.1+json\",\n        _rev: 0,\n        fields: {\n          \"*\": {\n            _type: \"application/vnd.oada.field.1+json\",\n            _rev: 0,\n            operations: {\n              \"*\": {\n                _type: \"application/vnd.oada.operation.1+json\",\n                _rev: 0\n              }\n            }\n          }\n        },\n        farms: {\n          \"*\": {\n            _type: \"application/vnd.oada.farm.1+json\",\n            _rev: 0\n          }\n        },\n        operations: {\n          \"*\": {\n            _type: \"application/vnd.oada.operation.1+json\",\n            _rev: 0\n          }\n        }\n      }\n    }\n  }\n};\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","import _ from 'lodash';\nimport uuid from 'uuid/v1';\nimport tree from '../../app/OADAManager/tree.js';\n\nexport default {\n  open({state}) {\n    const myState = state.view.FieldDetails;\n    myState.open = true;\n  },\n  close({state}) {\n    const myState = state.view.FieldDetails;\n    myState.open = false;\n  },\n  changeOADAFieldStatus({state, actions}, status) {\n    const selectedFieldId = _.get(state, `view.Map.selectedField`);\n    const operationId = _.get(state, `view.TopBar.OperationDropdown.selectedOperationId`)\n\n    let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n    let field = _.clone(_.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.operations.${operationId}.fields.${selectedFieldId}`)) || {}; //TODO year, organization\n    let newStatus = status;\n    if (field.status == status) newStatus = null; //Unchecking\n    field.status = newStatus;\n    if (field.status == null) {\n      //Optimistic Update\n      //Remove field from operation\n      _.unset(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.operations.${operationId}.fields.${selectedFieldId}`) //TODO year, organization\n      //Remove operation from season's field's operation list\n      _.unset(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.fields.${selectedFieldId}.operations.${operationId}`) //TODO year, organization\n\n      //Change on server\n      let requests = [\n        {  //Remove field to operation\n          type: 'application/vnd.oada.operation.1+json', //TODO oada.put should handle this\n          path: `/bookmarks/seasons/2019/operations/${operationId}/fields/${selectedFieldId}` //TODO year\n        },\n        { //Remove operation to field in season's field's operation list\n          type: 'application/vnd.oada.field.1+json',\n          path: `/bookmarks/seasons/2019/fields/${selectedFieldId}/operations/${operationId}` //TODO year\n        }\n      ];\n      actions.app.oada.delete({requests, connection_id: currentConnection});\n    } else {\n      //Optimistic Update\n      //Add field to operation\n      _.set(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.operations.${operationId}.fields.${selectedFieldId}`, field) //TODO year, organization\n      //Create operations key on season's field list if doesn't exist\n      if (_.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.fields.${selectedFieldId}.operations`) == null) _.set(state, `app.localData.abc123.seasons.2019.fields.${selectedFieldId}.operations`, {}) //TODO year, organization\n      //Add operation to field in season's field's operation list\n      _.set(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.fields.${selectedFieldId}.operations.${operationId}`, {}) //TODO year, organization\n\n      //Change on server\n      const operation = _.get(state, `view.TopBar.OperationDropdown.selectedOperation`)\n      let requests = [\n        {  //Add field to operation\n          tree,\n          data: field,\n          type: 'application/vnd.oada.operation.1+json', //TODO oada.put should handle this\n          path: `/bookmarks/seasons/2019/operations/${operationId}/fields/${selectedFieldId}` //TODO year\n        },\n        { //Add operation to field in season's field's operation list\n          tree,\n          data: {_id: operation._id}, //OADA _id\n          type: 'application/vnd.oada.field.1+json',\n          path: `/bookmarks/seasons/2019/fields/${selectedFieldId}/operations/${operationId}` //TODO year\n        }\n      ];\n      actions.app.oada.put({requests, connection_id: currentConnection});\n    }\n  },\n  changeLocalFieldStatus({state}, status) {\n    const myState = state.view.FieldDetails;\n    const selectedFieldId = _.get(state, `view.Map.selectedField`);\n    const operationId = _.get(state, `view.TopBar.OperationDropdown.selectedOperationId`)\n    var field = _.clone(_.get(state, `app.localData.abc123.seasons.2019.operations.${operationId}.fields.${selectedFieldId}`)) || {}; //TODO year, organization\n    var newStatus = status;\n    if (field.status == status) newStatus = null; //Unchecking\n    field.status = newStatus;\n    if (field.status == null) {\n      //Remove field from operation\n      _.unset(state, `app.localData.abc123.seasons.2019.operations.${operationId}.fields.${selectedFieldId}`) //TODO year, organization\n      //Remove operation from season's field's operation list\n      _.unset(state, `app.localData.abc123.seasons.2019.fields.${selectedFieldId}.operations.${operationId}`) //TODO year, organization\n    } else {\n      //Add field to operation\n      _.set(state, `app.localData.abc123.seasons.2019.operations.${operationId}.fields.${selectedFieldId}`, field) //TODO year, organization\n      //Create operations key on season's field list if doesn't exist\n      if (_.get(state, `app.localData.abc123.seasons.2019.fields.${selectedFieldId}.operations`) == null) _.set(state, `app.localData.abc123.seasons.2019.fields.${selectedFieldId}.operations`, {}) //TODO year, organization\n      //Add operation to field in season's field's operation list\n      _.set(state, `app.localData.abc123.seasons.2019.fields.${selectedFieldId}.operations.${operationId}`, {}) //TODO year, organization\n    }\n  },\n  onStatusChange({state, actions}, {status}) {\n    const myActions = actions.view.FieldDetails;\n    if (state.app.OADAManager.connected) {\n      myActions.changeOADAFieldStatus(status)\n    } else {\n      myActions.changeLocalFieldStatus(status)\n    }\n  },\n  onAddNewOperationClick({actions}) {\n    actions.view.TopBar.OperationDropdown.onAdd();\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","export default {\n  open: false,\n  selectedField: null\n}\n","export default {\n  \n}\n","import _ from 'lodash';\n\nexport default {\n  fieldStyles: {},\n  selectedField: null,\n  editingField: null,\n  center: [41.448068, -84.972648],\n  zoom: 13,\n  bounds: [\n    [\n      41.44053877385792,\n      -84.97886180877687\n    ],\n    [\n      41.46330393671208,\n      -84.96770381927492\n    ]\n  ],\n  fields: ({}, state) => {\n    const fieldStyles = _.get(state, `view.Map.fieldStyles`)\n    const editingField = _.get(state, `view.Map.editingField`)\n    const drawingBoundary = _.get(state, `view.Map.BoundaryDrawing.drawing`)\n    const operation = _.get(state, `view.TopBar.OperationDropdown.selectedOperation`)\n    const fieldsToRender = _.get(state, `app.seasonFields`);\n    return _.chain(fieldsToRender).mapValues((field, id) => {\n      if (editingField == id) return null; //Don't show this field.\n      var styledField = _.clone(field);\n      //Add any styles\n      if (fieldStyles[id] != null) styledField.style = fieldStyles[id];\n      //Fill based on status of current operation\n      if (operation) {\n        var color = \"white\"\n        if (operation.fields && operation.fields[id]) {\n          if (operation.fields[id].status == 'planned') color = 'red'\n          if (operation.fields[id].status == 'started') color = 'orange'\n          if (operation.fields[id].status == 'done') color = '#0acd00' //Green\n        }\n        styledField.style = _.merge({}, styledField.style, {fillColor: color, color})\n      }\n      return styledField;\n    }).omitBy((v, k) => {\n      if (v == null) return true;\n    }).value();\n  }\n}\n","import _ from 'lodash';\nimport Promise from 'bluebird';\nimport BBox from '@turf/bbox';\nimport GeoJSON from 'geojson';\n\nexport default {\n  async zoomTo({state}, {latitude, longitude, zoom}) {\n    const myState = _.get(state, 'view.Map');\n    myState.center = [latitude, longitude];\n    myState.zoom = zoom;\n    await Promise.delay(500);\n    myState.center = null;\n    myState.zoom = null;\n  },\n  styleField: {\n    highlight({state}, fieldId) {\n      if (fieldId) {\n        const myState = _.get(state, 'view.Map');\n        _.set(myState, `fieldStyles.${fieldId}`, {weight: 5})\n      }\n    },\n    unhighlight({state}, fieldId) {\n      if (fieldId) {\n        const myState = _.get(state, 'view.Map');\n        _.set(myState, `fieldStyles.${fieldId}`, {weight: 3})\n      }\n    }\n  },\n  async unselectField({state, actions}) {\n    const myActions = _.get(actions, 'view.Map');\n    const myState = _.get(state, 'view.Map');\n    if (myState.selectedField) {\n      actions.view.FieldDetails.close();\n      myActions.styleField.unhighlight(myState.selectedField);\n      await Promise.delay(200)\n      myState.selectedField = null;\n    }\n  },\n  onFieldClick({state, actions}, {id}) {\n    const myActions = _.get(actions, 'view.Map');\n    const myState = _.get(state, 'view.Map');\n    const drawing = _.get(myState, `BoundaryDrawing.drawing`);\n    if (!drawing) {\n      myActions.styleField.unhighlight(myState.selectedField);\n      myState.selectedField = id;\n      myActions.styleField.highlight(id);\n      actions.view.FieldDetails.open();\n    }\n  },\n  onMapClick({actions}, props) {\n    const myActions = _.get(actions, 'view.Map');\n    myActions.unselectField()\n    //Pass click to boundary drawing\n    myActions.BoundaryDrawing.onMapClick(props)\n  },\n  async zoomBounds({state}, props) {\n    const myState = _.get(state, 'view.Map');\n    const fields = _.compact(_.map(myState.fields, (f) => {\n      if (!f.boundary) return null; //Don't include fields without boundaries\n      return {geo: f.boundary}\n    }));\n    const featureCollection = GeoJSON.parse(fields, {GeoJSON: 'geo'})\n    const bounds = BBox(featureCollection)\n    myState.bounds = [[bounds[1], bounds[0]], [bounds[3], bounds[2]]];\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","export default {\n  boundary: {},\n  drawing: false\n}\n","import _ from 'lodash';\nimport {pipe, debounce, mutate} from 'overmind';\nimport uuid from 'uuid/v1';\n\nexport default {\n  addPointToBoundary({state}, props) {\n    const myState = state.view.Map.BoundaryDrawing;\n    _.set(myState, `boundary.${uuid()}`, [props.lat, props.lng]);\n  },\n  updateBoundaryPoint: pipe(debounce(10), mutate(({state}, props) => {\n    const myState = state.view.Map.BoundaryDrawing;\n    _.set(myState, `boundary.${props.id}`, [props.latlng.lat, props.latlng.lng]);\n  })),\n  onMapClick({state, actions}, {lat, lng}) {\n    const myState = state.view.Map.BoundaryDrawing;\n    const myActions = actions.view.Map.BoundaryDrawing;\n    if (myState.drawing) {\n      myActions.addPointToBoundary({lat, lng});\n    }\n  },\n  onMarkerMove({actions}, props) {\n    const myActions = actions.view.Map.BoundaryDrawing;\n    myActions.updateBoundaryPoint(props);\n  },\n  onStartDrawing({state}, props) {\n    const myState = state.view.Map.BoundaryDrawing;\n    myState.boundary = (props || {}).boundary || {};\n    myState.drawing = true;\n  },\n  onStopDrawing({state}, props) {\n    const myState = state.view.Map.BoundaryDrawing;\n    myState.drawing = false;\n    myState.boundary = {};\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\nimport * as BoundaryDrawing from './BoundaryDrawing'\n\nexport const state = {\n  BoundaryDrawing: BoundaryDrawing.state,\n  ..._state\n};\nexport const actions = {\n  BoundaryDrawing: BoundaryDrawing.actions,\n  ..._actions\n}\n","import config from '../../../config'\nexport default {\n  OADADomain: {\n    open: false,\n    domain: config.oadaDomain\n  }\n}\n","import _ from 'lodash';\nimport uuid from 'uuid/v1'\nimport tree from \"../../app/OADAManager/tree\";\n\nexport default {\n  OADADomain: {\n    open({state}) {\n      const myState = state.view.Modals.OADADomain;\n      myState.open = true;\n    },\n    close({state}) {\n      const myState = state.view.Modals.OADADomain;\n      myState.open = false;\n    },\n    onConnectClick({actions}) {\n      const myActions = actions.view.Modals.OADADomain;\n      myActions.open();\n    },\n    onDomainChange({state}, {domain}) {\n      const myState = state.view.Modals.OADADomain;\n      myState.domain = domain;\n    },\n    async onConnect({actions, state}) {\n      const myState = state.view.Modals.OADADomain;\n      const myActions = actions.view.Modals.OADADomain;\n      const {domain} = myState;\n      myState.loading = true;\n      await actions.app.OADAManager.onDomainChanged({domain});\n      myState.loading = false;\n      myActions.close()\n    },\n    onCancel({actions}) {\n      const myActions = actions.view.Modals.OADADomain;\n      myActions.close();\n    }\n  }\n}\n","import _ from 'lodash';\nimport uuid from 'uuid/v1'\nimport tree from \"../../../app/OADAManager/tree\";\n\n\nfunction convertToGEOJSON(points) {\n  var boundary = {\n    type: \"Polygon\",\n    coordinates: [_.map(points, (p) => {return [p[1], p[0]]})] //Flip lat/lng and add array around\n  }\n  //Add first point again\n  if (boundary.coordinates && boundary.coordinates[0] && boundary.coordinates[0].length > 0) {\n    boundary.coordinates[0].push(boundary.coordinates[0][0]);\n  }\n  return boundary;\n}\nfunction getChanges({state, actions}, {fieldId, newBoundary, farmId, farm_id, seasonFarm_id}) {\n  const myState = state.view.Modals.SaveField;\n  //See if name or boundary has changed\n  let seasonField = actions.app.getSeasonField(fieldId);\n  let newName = myState.name;\n  var seasonFieldChanges = {};\n  var fieldChanges = {};\n  //Get changes the effect both\n  if (newName != seasonField.name) seasonFieldChanges.name = newName;\n  if (_.isEqual(newBoundary, seasonField.boundary) == false) seasonFieldChanges.boundary = newBoundary;\n\n  fieldChanges = _.cloneDeep(seasonFieldChanges)\n  //See if farm has changed\n  if (seasonFarm_id) {\n    //Connected to oada\n    if (!seasonField.farm || seasonField.farm._id != seasonFarm_id) {\n      seasonFieldChanges.farm = {_id: seasonFarm_id};\n      //TODO this isn't right, we shouldn't be adding a farm in the function that calls this if it isn't our current year\n      fieldChanges.farm = {_id: farm_id};\n    }\n  } else {\n    //Local\n    if (!seasonField.farm || seasonField.farm.id != farmId) {\n      seasonFieldChanges.farm = {id: farmId};\n      fieldChanges.farm = {id: farmId};\n    }\n  }\n  //TODO only change field if is current year\n  return {fieldChanges, seasonFieldChanges};\n}\nfunction saveChangesToLocalData({state}, editingFieldId, fieldChanges, seasonFieldChanges) {\n  if (_.isEmpty(fieldChanges) && _.isEmpty(seasonFieldChanges)) return;\n  const fieldPath = `app.localData.abc123.fields.fields.${editingFieldId}`; //TODO organization\n  _.set(state, fieldPath, _.merge({}, _.get(state, fieldPath), fieldChanges));\n  const seasonFieldPath = `app.localData.abc123.seasons.2019.fields.${editingFieldId}` //TODO year, organization\n  _.set(state, seasonFieldPath, _.merge({}, _.get(state, seasonFieldPath), seasonFieldChanges));\n}\nasync function saveChangesToOADA(context, editingFieldId, fieldChanges, seasonFieldChanges) {\n  const { state, actions } = context;\n  if (_.isEmpty(fieldChanges) && _.isEmpty(seasonFieldChanges)) return;\n  //Add to OADA\n  let requests = [];\n  if (_.isEmpty(fieldChanges) == false) {\n    requests.push({\n      tree,\n      data: fieldChanges,\n      path: `/bookmarks/fields/fields/${editingFieldId}`\n    })\n  }\n  if (_.isEmpty(seasonFieldChanges) == false) {\n    requests.push({\n      tree,\n      data: seasonFieldChanges,\n      path: `/bookmarks/seasons/2019/fields/${editingFieldId}` //TODO year\n    })\n  }\n  console.log('fieldChanges', fieldChanges);\n  console.log('seasonFieldChanges', seasonFieldChanges);\n  const connection_id = _.get(state, `app.OADAManager.currentConnection`)\n  await actions.app.oada.put({requests, connection_id})\n}\n\nfunction createField(context, {boundary, farmId, farm_id}) {\n  const { state } = context;\n  const myState = state.view.Modals.SaveField;\n  var field = {\n    name: myState.name,\n    boundary: boundary,\n    farm: (farm_id) ?\n      {\n        _id: farm_id //OADA farm resource id\n      }\n      :\n      {\n        id: farmId\n      }\n  }\n  return field\n}\nfunction addFieldToLocalData(context, {field}) {\n  const { state } = context;\n  const id = uuid();\n  _.set(state, `app.localData.abc123.fields.fields.${id}`, field); //TODO organization\n  _.set(state, `app.localData.abc123.seasons.2019.fields.${id}`, {...field, operations: {}, year: '2019'}); //TODO year, organization\n  return id;\n}\nasync function addFieldToOADA(context, {field, seasonField}) {\n  const { state, actions } = context;\n  const id = uuid();\n  //Add to OADA\n  let requests = [];\n  if (field) {\n    requests.push({\n      tree,\n      data: field,\n      path: `/bookmarks/fields/fields/${id}`\n    })\n  }\n  if (seasonField) {\n    requests.push({\n      tree,\n      data: {...seasonField, operations: {}, year: '2019'}, //TODO year\n      path: `/bookmarks/seasons/2019/fields/${id}` //TODO year\n    })\n  }\n  let connection_id = _.get(state, `app.OADAManager.currentConnection`)\n  await actions.app.oada.put({requests, connection_id})\n}\n\nexport default {\n  open({state, actions}) {\n    const myState = state.view.Modals.SaveField;\n    const editingField = _.get(state, `view.Map.editingField`);\n    if (editingField == null) {\n      myState.name = \"\";\n    } else {\n      let field = actions.app.getSeasonField(editingField);\n      //Populate the name in the modal popup\n      myState.name = field.name;\n      if (state.app.OADAManager.connected) {\n        //Get season farm id by oada id\n        const farmId = _.get(state, `app.oadaSeasonFarmsIdBy_id.${_.get(field, 'farm._id')}.id`)\n        myState.farmId = farmId;\n      } else {\n        myState.farmId = _.get(field, 'farm.id');\n      }\n    }\n    myState.open = true;\n  },\n  close({state}) {\n    const myState = state.view.Modals.SaveField;\n    myState.open = false;\n  },\n  async saveField(context) {\n    const {state} = context;\n    const myState = state.view.Modals.SaveField;\n    //Convert the field to geojson\n    const points = _.get(state, `view.Map.BoundaryDrawing.boundary`)\n    const boundary = convertToGEOJSON(points);\n\n    //Create farm or get existing farms id (cannot update an existing farm here)\n    let farmId = myState.farmId;\n    let farm_id = null;\n    let seasonFarm_id = null;\n    let farm = myState.farm;\n    if (farm) {\n      if (state.app.OADAManager.connected) {\n        //Get farm_id\n        farm_id = _.get(state, `app.oadaOrgData.fields.farms.${farmId}._id`)\n        //Get seasonFarm_id from farmId\n        seasonFarm_id = _.get(state, `app.seasonFarms.${farmId}._id`)\n      }\n    }\n    //Update or create field\n    let editingFieldId = _.get(state, `view.Map.editingField`);\n    if (editingFieldId) {\n      //We are editing a field find the changes, if any\n      const {fieldChanges, seasonFieldChanges} = getChanges(context, {fieldId: editingFieldId, newBoundary: boundary, farmId, farm_id, seasonFarm_id})\n      if (state.app.OADAManager.connected) {\n        saveChangesToOADA(context, editingFieldId, fieldChanges, seasonFieldChanges)\n      } else {\n        saveChangesToLocalData(context, editingFieldId, fieldChanges, seasonFieldChanges)\n      }\n    } else {\n      //TODO only add field if is current year, otherwise just seasonfield\n      if (state.app.OADAManager.connected) {\n        const field = await createField(context, {boundary, farm_id});\n        const seasonField = await createField(context, {boundary, farm_id: seasonFarm_id});\n        await addFieldToOADA(context, {field, seasonField})\n      } else {\n        const field = await createField(context, {boundary, farm, farmId: farmId})\n        await addFieldToLocalData(context, {field})\n      }\n    }\n  },\n  onSave({actions, state}) {\n    const myActions = actions.view.Modals.SaveField;\n    myActions.saveField();\n    actions.view.Map.BoundaryDrawing.onStopDrawing();\n    state.view.Map.editingField = null;\n    myActions.close();\n  },\n  onCancel({actions, state}) {\n    const myActions = actions.view.Modals.SaveField;\n    actions.view.Map.BoundaryDrawing.onStopDrawing();\n    state.view.Map.editingField = null;\n    myActions.close();\n  },\n  onNameChange({state}, {name}) {\n    const myState = state.view.Modals.SaveField;\n    myState.name = name;\n  },\n  onFarmSearchChange({state}, value) {\n    const myState = state.view.Modals.SaveField;\n    myState.farmSearch = value;\n  },\n  onFarmChange({state}, {id}) {\n    const myState = state.view.Modals.SaveField;\n    myState.farmId = id;\n  },\n  onFarmAdd({actions}) {\n    actions.view.Modals.NewFarm.open({callbackAction: 'view.Modals.SaveField.onFarmAddComplete'});\n  },\n  onFarmAddComplete({state}, {id}) {\n    const myState = state.view.Modals.SaveField;\n    //Update farmId\n    myState.farmId = id;\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","import _ from 'lodash';\nexport default {\n  open: false,\n  name: '',\n  farmSearch: '',\n  farms: ({farmSearch: search}, state) => {\n    return _.compact(_.map(state.app.seasonFarms, (f, id) => {\n      if (!f || search != '' && f.name && f.name.toLowerCase().search(search.toLowerCase()) == -1) return null;\n      return {key: id, text: f.name, value: id};\n    }))\n  },\n  farmId: null,\n  farm: ({farmId, farms}, state) => {\n    if (farmId) {\n      return _.get(state, `app.seasonFarms.${farmId}`)\n    }\n  }\n}\n","import _ from 'lodash';\nimport uuid from 'uuid/v1'\nimport tree from \"../../../app/OADAManager/tree\";\n\nfunction createOperation(context, {name}) {\n  var operation = {\n    name,\n    fields: {}\n  }\n  return operation;\n}\n\nfunction addOperationToLocalData({state}, {operation}) {\n  const id = uuid();\n  _.set(state, `app.localData.abc123.seasons.2019.operations.${id}`, operation); //TODO year, organization\n  return id;\n}\nasync function addOperationToOADA({state, actions}, {operation}) {\n  //Add to OADA\n  const id = uuid();\n  let requests = [\n    {\n      tree,\n      data: operation,\n      path: `/bookmarks/seasons/2019/operations/${id}` //TODO year\n    }\n  ];\n  const connection_id = _.get(state, `app.OADAManager.currentConnection`)\n  const ret = await actions.app.oada.put({requests, connection_id})\n  const _id = _.get(ret, 'responses.0.headers.content-location').substr(1); //Remove leading `/` from /resources/<uuid>\n  return {id, _id}\n}\n\nexport default {\n  open({state}) {\n    const myState = state.view.Modals.NewOperation;\n    myState.name = '';\n    myState.open = true;\n  },\n  close({state}) {\n    const myState = state.view.Modals.NewOperation;\n    myState.open = false;\n  },\n  async saveOperation(context) {\n    const {state} = context;\n    const myState = state.view.Modals.NewOperation;\n    const operation = createOperation(context, {name: myState.name})\n    if (state.app.OADAManager.connected) {\n      const {id, _id} = await addOperationToOADA(context, {operation});\n      _.set(state, `view.TopBar.OperationDropdown.selected`, id)\n    } else {\n      const id = await addOperationToLocalData(context, {operation});\n      _.set(state, `view.TopBar.OperationDropdown.selected`, id)\n    }\n  },\n  onNameChange({state}, {name}) {\n    const myState = state.view.Modals.NewOperation;\n    myState.name = name;\n  },\n  onCancel({actions}) {\n    const myActions = actions.view.Modals.NewOperation;\n    myActions.close();\n  },\n  async onSave({actions}) {\n    const myActions = actions.view.Modals.NewOperation;\n    await myActions.saveOperation();\n    myActions.close();\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","export default {\n  open: false,\n  name: ''\n}\n","import _ from 'lodash';\nimport uuid from 'uuid/v1'\nimport tree from \"../../../app/OADAManager/tree\";\n\nfunction createFarm(context, {name}) {\n  var farm = {\n    name\n  }\n  return farm;\n}\nfunction addFarmToLocalData(context, {farm}) {\n  const { state } = context;\n  const id = uuid();\n  _.set(state, `app.localData.abc123.farms.${id}`, farm); //TODO organization\n  _.set(state, `app.localData.abc123.seasons.2019.farms.${id}`, farm); //TODO year, organization\n  return id;\n}\nasync function addFarmToOADA(context, {farm}) {\n  const { state, actions } = context;\n  const id = uuid();\n  //TODO only add to season farms depending on what year is selected, need to figure out return values for that as well (since may only have one request)\n  //Add to OADA\n  let requests = [\n    {\n      tree,\n      data: farm,\n      path: `/bookmarks/fields/farms/${id}`\n    },\n    {\n      tree,\n      data: farm,\n      path: `/bookmarks/seasons/2019/farms/${id}` //TODO year\n    },\n  ];\n  let connection_id = _.get(state, `app.OADAManager.currentConnection`)\n  const ret = await actions.app.oada.put({requests, connection_id})\n  const farm_id = _.get(ret, 'responses.0.headers.content-location').substr(1); //Remove leading `/` from /resources/<uuid>\n  if (farm_id == null) throw 'OADA did not return an _id when creating a farm.'\n  const seasonFarm_id = _.get(ret, 'responses.1.headers.content-location').substr(1); //Remove leading `/` from /resources/<uuid>\n  if (seasonFarm_id == null) throw 'OADA did not return an _id when creating a season farm.'\n  return {farm_id, seasonFarm_id, id};\n}\nexport default {\n  open({state}, {callbackAction}) {\n    const myState = state.view.Modals.NewFarm;\n    myState.name = '';\n    myState.open = true;\n    myState.callbackAction = callbackAction || null;\n  },\n  close({state}) {\n    const myState = state.view.Modals.NewFarm;\n    myState.open = false;\n  },\n  async saveFarm(context) {\n    const {state, actions} = context;\n    const myState = state.view.Modals.NewFarm;\n    const farm = createFarm(context, {name: myState.name})\n    if (state.app.OADAManager.connected) {\n      const {farm_id, seasonFarm_id, id} = await addFarmToOADA(context, {farm});\n      if (myState.callbackAction) {\n        const action = _.get(actions, myState.callbackAction);\n        if (!action) throw `callbackAction: ${myState.callbackAction} does not exist.`\n        action({farm_id, seasonFarm_id, id});\n      }\n    } else {\n      const id = await addFarmToLocalData(context, {farm});\n      if (myState.callbackAction) {\n        const action = _.get(actions, myState.callbackAction);\n        if (!action) throw `callbackAction: ${myState.callbackAction} does not exist.`\n        action({id});\n      }\n    }\n  },\n  onNameChange({state}, {name}) {\n    const myState = state.view.Modals.NewFarm;\n    myState.name = name;\n  },\n  onCancel({actions}) {\n    const myActions = actions.view.Modals.NewFarm;\n    myActions.close();\n  },\n  async onSave({actions}) {\n    const myActions = actions.view.Modals.NewFarm;\n    await myActions.saveFarm();\n    myActions.close();\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","export default {\n  open: false,\n  name: ''\n}\n","import _state from './state'\nimport _actions from './actions'\nimport * as SaveField from './SaveField'\nimport * as NewOperation from './NewOperation'\nimport * as NewFarm from './NewFarm'\n\nexport const state = {\n  SaveField: SaveField.state,\n  NewOperation: NewOperation.state,\n  NewFarm: NewFarm.state,\n  ..._state\n};\nexport const actions = {\n  SaveField: SaveField.actions,\n  NewOperation: NewOperation.actions,\n  NewFarm: NewFarm.actions,\n  ..._actions\n}\n","import _ from 'lodash'\nimport uuid from 'uuid/v1'\n\nexport default {\n  onMyLocationClick({actions}, coords) {\n    if (!coords) return;\n    const {latitude, longitude} = coords;\n    actions.view.Map.zoomTo({latitude, longitude, zoom: 15})\n  },\n  onLocationChange({state}, coords) {\n    if (!coords) return;\n    const {latitude, longitude} = coords;\n    state.view.Map.location = {latitude, longitude};\n  },\n  onAddField({actions}) {\n    actions.view.Map.BoundaryDrawing.onStartDrawing();\n  },\n  onSaveField({actions}) {\n    actions.view.Modals.SaveField.open();\n  },\n  onCancelField({state, actions}) {\n    state.view.Map.editingField = null; //Stop editing if we were\n    actions.view.Map.BoundaryDrawing.onStopDrawing();\n  },\n  onEditField({actions, state}) {\n    const currentField = state.view.FieldDetails.field;\n    //Hide the current boundary\n    state.view.Map.editingField = state.view.FieldDetails.fieldId;\n    //Convert to drawing boundary: {<rand-id>: [lat, lng], ...}\n    let boundary = {};\n    let coors = _.get(currentField, 'boundary.coordinates.0');\n    if (coors.length > 0) coors.pop();\n    _.forEach(coors || [], (coors) => { //TODO will not work with holes in fields etc\n      boundary[uuid()] = [coors[1], coors[0]];\n    });\n    //Start drawing\n    actions.view.Map.BoundaryDrawing.onStartDrawing({boundary});\n    //Close the details drawer\n    actions.view.Map.unselectField()\n  },\n  async onResetCache({actions}) {\n    await actions.app.oada.resetCache();\n    //Refresh the page\n    //location.reload();\n  },\n  async onLogout({actions}) {\n    await actions.view.Login.logout()\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","import _ from 'lodash';\n\nexport default {\n  open: false,\n  selected: null,\n  search: '',\n  list: ({selected, operations}, state) => {\n    //Get operations, filtering by search\n    const search = _.get(state, `view.TopBar.OperationDropdown.search`)\n    return _.omitBy(_.mapValues(operations, ({name}, id) => {\n      if (id == null) return null; //Not an operation, a _key for oada\n      if (name == null) return null;\n      if (search != '' && name.search(search) == -1) return null;\n      return {\n        text: name,\n        value: id,\n        selected: (selected == id),\n        label: { color: 'green', empty: true, circular: true }\n      }\n    }), _.isEmpty)\n  },\n  operations: ({}, state) => {\n    let operations = null;\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      operations = _.omitBy(_.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.operations`) || {}, (o, k) => {return _.startsWith(k, '_')}); //TODO year\n    } else {\n      operations = _.get(state, `app.localData.abc123.seasons.2019.operations`) //TODO year, organization\n    }\n    return operations\n  },\n  selectedOperationId: ({selected, operations}, state) => {\n    let selectedId = selected;\n    if (selectedId == null && _.keys(operations).length > 0) selectedId = _.keys(operations)[0];\n    return selectedId;\n  },\n  selectedOperation: ({selectedOperationId, operations}, state) => {\n    return operations[selectedOperationId];\n  }\n}\n","export default {\n  onAdd({state, actions}) {\n    const myState = state.view.TopBar.OperationDropdown;\n    myState.open = false;\n    return actions.view.Modals.NewOperation.open()\n  },\n  onChange({state}, {id}) {\n    const myState = state.view.TopBar.OperationDropdown;\n    myState.selected = id;\n    myState.open = false;\n  },\n  onOpenChange({state}, {open}) {\n    const myState = state.view.TopBar.OperationDropdown;\n    myState.open = open;\n  },\n  onSearch({state}, {search}) {\n    const myState = state.view.TopBar.OperationDropdown;\n    myState.search = search;\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\nimport * as OperationDropdown from './OperationDropdown'\n\nexport const state = {\n  OperationDropdown: OperationDropdown.state,\n  ..._state\n};\nexport const actions = {\n  OperationDropdown: OperationDropdown.actions,\n  ..._actions\n}\n","export default {\n\n}\n","import _state from './state'\nimport _actions from './actions'\n\nimport * as Login from './Login'\nimport * as FieldDetails from './FieldDetails'\nimport * as FieldList from './FieldList'\nimport * as Map from './Map'\nimport * as Modals from './Modals'\nimport * as TopBar from './TopBar'\n\nexport const state = {\n  Login: Login.state,\n  FieldDetails: FieldDetails.state,\n  FieldList: FieldList.state,\n  Map: Map.state,\n  Modals: Modals.state,\n  TopBar: TopBar.state,\n  ..._state\n};\nexport const actions = {\n  Login: Login.actions,\n  FieldDetails: FieldDetails.actions,\n  FieldList: FieldList.actions,\n  Map: Map.actions,\n  Modals: Modals.actions,\n  TopBar: TopBar.actions,\n  ..._actions\n}\nexport const onInitialize = async ({actions}) => {\n  await actions.app.onInitialize();\n  await actions.view.Login.onInitialize();\n}\n","import _ from 'lodash';\n\nexport default {\n  \n}\n","import _ from 'lodash'\nexport default {\n\n}\n","export default {\n  \"42f60b10-784c-11ea-8dfd-a3e960f56105\": {\n    \"name\": \"1004 G-N\",\n    \"boundary\": {\n      \"type\": \"Polygon\",\n      \"coordinates\": [\n        [\n          [\n            -84.97584700584412,\n            41.4628134964027\n          ],\n          [\n            -84.97539639472963,\n            41.462765256171906\n          ],\n          [\n            -84.97495651245119,\n            41.46275721612994\n          ],\n          [\n            -84.97424840927125,\n            41.46250797433487\n          ],\n          [\n            -84.97405529022217,\n            41.46203360827181\n          ],\n          [\n            -84.97410893440247,\n            41.46044164256161\n          ],\n          [\n            -84.97139453887941,\n            41.46130195211675\n          ],\n          [\n            -84.96770381927492,\n            41.46327177680542\n          ],\n          [\n            -84.97010707855226,\n            41.46330393671208\n          ],\n          [\n            -84.9764907360077,\n            41.46306273702346\n          ],\n          [\n            -84.97634053230287,\n            41.45965368547904\n          ],\n          [\n            -84.97462391853334,\n            41.46024867436535\n          ],\n          [\n            -84.9746346473694,\n            41.461004463187685\n          ],\n          [\n            -84.97491359710695,\n            41.46126175098986\n          ],\n          [\n            -84.97492432594301,\n            41.46172004235903\n          ],\n          [\n            -84.97529983520509,\n            41.46208988917259\n          ],\n          [\n            -84.97581481933594,\n            41.46234717266838\n          ],\n          [\n            -84.9761688709259,\n            41.46278133625282\n          ]\n        ]\n      ]\n    },\n    \"farm\": {\n      \"id\": \"42f08cd0-784c-11ea-8dfd-a3e960f56105\"\n    }\n  },\n  \"7c0ce950-784c-11ea-bfa5-97fea4f9bfd9\": {\n    \"name\": \"1001 HO-N\",\n    \"boundary\": {\n      \"type\": \"Polygon\",\n      \"coordinates\": [\n        [\n          [\n            -84.97347593307495,\n            41.44864540647965\n          ],\n          [\n            -84.97626543045044,\n            41.44856498851091\n          ],\n          [\n            -84.97617959976196,\n            41.44784122230691\n          ],\n          [\n            -84.977445602417,\n            41.44782513852177\n          ],\n          [\n            -84.97759580612183,\n            41.44862932289387\n          ],\n          [\n            -84.97886180877687,\n            41.448532821295515\n          ],\n          [\n            -84.97866868972778,\n            41.44205080201176\n          ],\n          [\n            -84.97654438018799,\n            41.442887227983185\n          ],\n          [\n            -84.97549295425415,\n            41.44425443952937\n          ],\n          [\n            -84.97323989868165,\n            41.44608806625952\n          ],\n          [\n            -84.97272491455078,\n            41.44689227216232\n          ],\n          [\n            -84.97330427169801,\n            41.44726220353039\n          ]\n        ]\n      ]\n    },\n    \"farm\": {\n      \"id\": \"42f08cd0-784c-11ea-8dfd-a3e960f56105\",\n    }\n  },\n  \"8ab27420-784c-11ea-bfa5-97fea4f9bfd9\": {\n    \"name\": \"1002 HO-S\",\n    \"boundary\": {\n      \"type\": \"Polygon\",\n      \"coordinates\": [\n        [\n          [\n            -84.97152328491212,\n            41.44697269220437\n          ],\n          [\n            -84.97148036956789,\n            41.44166475561947\n          ],\n          [\n            -84.97152328491212,\n            41.44111785263252\n          ],\n          [\n            -84.97347593307495,\n            41.441085681725035\n          ],\n          [\n            -84.97373342514038,\n            41.44073180069027\n          ],\n          [\n            -84.97635126113893,\n            41.44053877385792\n          ],\n          [\n            -84.97645854949953,\n            41.44134304853828\n          ],\n          [\n            -84.97607231140138,\n            41.44161649965898\n          ],\n          [\n            -84.97611522674562,\n            41.44240467585386\n          ],\n          [\n            -84.97540712356569,\n            41.44398099952468\n          ]\n        ]\n      ]\n    },\n    \"farm\": {\n      \"id\": \"42f08cd0-784c-11ea-8dfd-a3e960f56105\"\n    }\n  }\n}\n","export default {\n  \"42f08cd0-784c-11ea-8dfd-a3e960f56105\": {\n    name: \"Bowman and Bowman\"\n  },\n  \"52f08cd0-784c-11ea-8dfd-a3e960f56105\": {\n    name: \"Martz Farms\"\n  }\n}\n","import testFields from './test/testFields';\nimport testFarms from './test/testFarms';\nimport _ from 'lodash';\nimport geojsonArea from '@mapbox/geojson-area';\n\nexport default {\n  acresStatus: ({}, state) => {\n    //Get id's of all fields in this operation\n    const operationFields = state.app.operationFields;\n    const seasonFields = state.app.seasonFields;\n    //Loop through each field, totaling acres.\n    let planned = 0;\n    let started = 0;\n    let done = 0;\n    _.forEach(operationFields, (fieldOperation, key) => {\n      if (fieldOperation == null) return;\n      //Get field\n      let field = seasonFields[key];\n      if (field == null) return;\n      //Compute area of field boundary\n      let area = geojsonArea.geometry(field.boundary) * 0.000247105 //Meters to acres;\n      if (fieldOperation.status == 'planned') {\n        planned += area;\n      } else if (fieldOperation.status == 'started') {\n        started += area;\n      } else if (fieldOperation.status == 'done') {\n        done += area;\n      }\n    });\n    let total = planned + started + done;\n    return {\n      planned: Math.round(planned),\n      plannedPercentage: Math.round((planned / (total || 1)) * 100),\n      started: Math.round(started),\n      startedPercentage: Math.round((started / (total || 1)) * 100),\n      done: Math.round(done),\n      donePercentage: Math.round((done / (total || 1)) * 100),\n    };\n  },\n  seasonFarms: ({}, state) => {\n    let farms;\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      farms = _.chain(state).get(`app.oada.${currentConnection}.bookmarks.seasons.2019.farms`).omitBy((v, k) => { //TODO year\n        if (_.startsWith(k, '_')) return true;\n        if (v == null) return true;\n      }).value();\n    } else {\n      farms = _.get(state, `app.localData.abc123.seasons.2019.farms`) //TODO year, organization\n    }\n    return farms || {};\n  },\n  seasonFields: ({}, state) => {\n    let fields;\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      fields = _.chain(state).get(`app.oada.${currentConnection}.bookmarks.seasons.2019.fields`).omitBy((v, k) => { //TODO year\n        if (_.startsWith(k, '_')) return true;\n        if (v == null) return true;\n      }).value();\n    } else {\n      fields = _.get(state, `app.localData.abc123.seasons.2019.fields`) //TODO year, organization\n    }\n    return fields || {};\n  },\n  operationFields: ({}, state) => {\n    let operationId = _.get(state, 'view.TopBar.OperationDropdown.selectedOperationId');\n    let operationFields = [];\n    if (operationId != null) {\n      if (_.get(state, `app.OADAManager.connected`) == true) {\n        let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n        operationFields = _.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.operations.${operationId}.fields`) || []; //TODO year\n      } else {\n        operationFields = _.get(state, `app.localData.abc123.seasons.2019.operations.${operationId}.fields`) || []; //TODO year, organization\n      }\n    }\n    return operationFields; // {<field-id>: {status: 'planned'}, ...}\n  },\n  currentOADA: ({}, state) => {\n    if (state.app.OADAManager.connected) {\n      const currentConnection = state.app.OADAManager.currentConnection;\n      if (!currentConnection) return;\n      return state.app.oada[currentConnection];\n    }\n  },\n  oadaOrgData: ({currentOADA}) => {\n    if (currentOADA) {\n      return currentOADA.bookmarks;\n    }\n  },\n  oadaSeasonFarmsIdBy_id: ({oadaOrgData}, state) => {\n    return _.chain(oadaOrgData).get(`seasons.2019.farms`).mapValues((v, k) => {\n      if (!v) return null\n      return {_id: v._id, id: k};\n    }).omitBy(_.isNull).mapKeys((v, k) => {\n      return v._id; //Key of oada id\n    }).value();  //{_id: <oada-res-id>, id: <path-id>}\n  },\n  oadaSeasonFarms_idByFarm_id: ({oadaOrgData}, state) => {\n    return _.chain(oadaOrgData).get(`fields.farms`).mapValues((v, k) => {\n      if (!v) return null\n      //Lookup season farm id\n      const seasonFarm_id = _.get(oadaOrgData, `seasons.2019.farms.${k}._id`);\n      return {seasonFarm_id: seasonFarm_id, farm_id: v._id};\n    }).omitBy(_.isNull).mapKeys((v, k) => {\n      return v.farm_id; //Key of oada id\n    }).value();  //{_id: <oada-res-id>, id: <path-id>}\n  },\n  localOrgData: ({localData}) => {\n    return localData.abc123; //TODO organization\n  },\n  localData: {\n    organizations: {\n      'abc123': {\n        name: 'Default'\n      }\n    },\n    'abc123': {\n      fields: {\n        fields: {\n          /*'a': {\n            id: 'a',\n            name: 'Back 40',\n            boundary: '' //GEOJSON\n          }*/\n          ...testFields,\n        },\n        farms: {\n          ...testFarms,\n        }\n      },\n      seasons: {\n        /*'2019': {\n          fields: {\n            '<field-uuid>': {\n              season: 2018,\n              boundary: <geo-json>,\n              operations: {\n                '<operation-uuid>': {}\n              }\n            }\n          },\n          operations: {\n            '<operation-uuid>': {\n              id: '<operation-uuid>',\n              year: 2019,\n              name: 'Corn Planting',\n              fields: {\n                '<field-uuid>': {\n                  status: 'Planned',\n                }\n              }\n            }\n          }\n        }*/\n        '2019': {\n          fields: {\n            ...testFields,\n          },\n          farms: {\n            ...testFarms,\n          },\n          operations: {\n            /*'<operation-uuid>': {\n              id: '<operation-uuid>',\n              year: 2019,\n              name: 'Corn Planting',\n              fields: {\n                '<field-uuid>': {\n                  status: 'Planned',\n                }\n              }\n            }*/\n          }\n        }\n      }\n    }\n  }\n}\n","import _ from 'lodash'\nexport default {\n  getSeasonField({state}, id) {\n    let fields = [];\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      fields = _.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.fields`) //TODO year\n    } else {\n      fields = _.get(state, `app.localData.abc123.seasons.2019.fields`) //TODO year, organization\n    }\n    return fields[id];\n  },\n  getSeasonFarm({state}, id) {\n    let farms = [];\n    if (_.get(state, `app.OADAManager.connected`) == true) {\n      let currentConnection = _.get(state, `app.OADAManager.currentConnection`)\n      farms = _.get(state, `app.oada.${currentConnection}.bookmarks.seasons.2019.farms`) //TODO year\n    } else {\n      farms = _.get(state, `app.localData.abc123.seasons.2019.farms`) //TODO year, organization\n    }\n    return farms[id];\n  },\n  onInitialize({state, actions}) {\n    actions.view.Map.zoomBounds();\n  }\n}\n","import _ from 'lodash';\nexport default {\n  connected: false,\n  currentConnection: null,\n  domain: null,\n  token: null,\n  user: ({currentConnection}, state) => {\n    if (!currentConnection) return null;\n    return _.get(state, 'app.oada.localhost.users.me');\n  }\n}\n","import tree from './tree';\nimport config from '../../../config'\nimport Promise from 'bluebird'\nimport _ from 'lodash'\nimport { browser as oadaIdClient } from '@oada/oada-id-client/index.js'\nconst getAccessToken = Promise.promisify(oadaIdClient.getAccessToken)\n\nexport default {\n  async getToken({state}, domain) {\n    /*\n      Get token from local storage or request one\n    */\n    const myState = state.app.OADAManager;\n    if (myState.token) return myState.token;\n    let res = await getAccessToken(domain.replace(/^https?:\\/\\//, ''), {\n      metadata: config.METADATA,\n      scope: config.SCOPE,\n      redirect: config.REDIRECT\n    })\n    return res.access_token;\n  },\n  async connect({actions, state, effects}, {domain, token}) {\n    const myState = state.app.OADAManager;\n    const myActions = actions.app.OADAManager;\n    if (token) myState.token = token;\n    token = await myActions.getToken(domain);\n    return actions.app.oada.connect({\n      token,\n      domain: domain,\n      options: config.OPTIONS,\n      cache: false\n    }).then((response) => {\n      if (!response.error) {\n        myState.currentConnection = response.connectionId;\n        myState.token = response.token;\n        myState.connected = true;\n        //Unselect local opeation\n        state.view.TopBar.OperationDropdown.selected = null;\n      }\n      return response;\n    })\n  },\n  async logout({actions, state}) {\n    const myState = state.app.OADAManager;\n    const {currentConnection: connection_id} = myState;\n    myState.token = null;\n    await actions.app.oada.disconnect({connection_id})\n  },\n  async getUserInfo({actions, state}) {\n    const myState = state.app.OADAManager;\n    const {currentConnection: connection_id} = myState;\n    let requests = [{\n      path: '/users/me',\n    }];\n    await actions.app.oada.get({requests, connection_id})\n  },\n  async fetchAndWatch({actions, state}) {\n    const myState = state.app.OADAManager;\n    const {currentConnection: connection_id} = myState;\n    //Fetch field and seasons\n    let watchRequests = [\n      {\n        path: '/bookmarks/fields',\n        tree,\n        watch: {\n          actions: [actions.app.OADAManager.onFieldChanged]\n        }\n      },\n      {\n        path: '/bookmarks/seasons',\n        tree,\n        watch: {\n          actions: [actions.app.OADAManager.onSeasonsChanged]\n        },\n      }\n    ];\n    const ret = await actions.app.oada.get({requests: watchRequests, connection_id})\n    let rewatchRequests = [];\n    console.log('SOMETIMES ERRORS:', ret);\n    if (ret.responses[0].error) {\n      //On 404 create and rewatch\n      if (ret.responses[0].status != 404) throw ret.responses[0].error;\n      //Create fields and try to watch again\n      let requests = [{\n        tree,\n        data: {\n          fields: {},\n          farms: {}\n        },\n        path: '/bookmarks/fields'\n      }];\n      //Create\n      await actions.app.oada.put({requests, connection_id})\n      //Rewatch\n      rewatchRequests.push(watchRequests[0]);\n    }\n    if (ret.responses[1].error) {\n      //On 404 create and rewatch\n      if (ret.responses[1].status != 404) throw ret.responses[0].error;\n      //Create seasons and try to watch again\n      let requests = [{\n        tree,\n        data: {},\n        path: '/bookmarks/seasons'\n      }];\n      //Create\n      await actions.app.oada.put({requests, connection_id})\n      //Rewatch\n      rewatchRequests.push(watchRequests[1]);\n    }\n    if (rewatchRequests.length > 0) await actions.app.oada.get({requests: rewatchRequests, connection_id})\n  },\n  initSeasonFields({state, actions}) {\n    /*\n      Put changes from master field list into season fields\n    */\n    const myActions = actions.app.OADAManager;\n    //Get master field list fields\n    var fieldsChanged = [];\n    _.forEach(_.get(state, 'app.oadaOrgData.fields.fields'), (obj, key) => {\n      if (_.startsWith(key, '_')) return;\n      fieldsChanged.push({fieldId: key, name: obj.name, boundary: obj.boundary, farm: obj.farm});\n    })\n    return myActions.changeSeasonFields(fieldsChanged);\n  },\n  initSeasonFarms({state, actions}) {\n    /*\n      Put changes from master farm list into season farms\n    */\n    const myActions = actions.app.OADAManager;\n    //Get master field list fields\n    var changed = [];\n    _.forEach(_.get(state, 'app.oadaOrgData.fields.farms'), (obj, key) => {\n      if (_.startsWith(key, '_')) return;\n      changed.push({farmId: key, name: obj.name});\n    })\n    return myActions.changeSeasonFarms(changed);\n  },\n  async changeSeasonFields({state, actions}, fieldsChanged) {\n    /*\n      Apply any changes to season fields\n    */\n    const myState = state.app.OADAManager;\n    const {currentConnection: connection_id} = myState;\n    //See if they match season fields.\n    let requests = [];\n    let theSeasonFields = state.app.seasonFields;\n    _.forEach(fieldsChanged, (fieldChange) => {\n      if (fieldChange.fieldId == null) return;\n      let data = {};\n      let seasonField = theSeasonFields[fieldChange.fieldId]\n      if (fieldChange.name) {\n        if (seasonField == null || seasonField.name != fieldChange.name) {\n          data.name = fieldChange.name;\n        }\n      }\n      if (fieldChange.boundary) {\n        if (seasonField == null || _.isEqual(seasonField.boundary, fieldChange.boundary) == false) {\n          data.boundary = fieldChange.boundary;\n        }\n      }\n      if (fieldChange.farm) {\n        //Find new season farm id from farm id\n        const farmId = _.get(fieldChange, 'farm._id');\n        if (farmId) {\n          const seasonFarmId = _.get(state, `app.oadaSeasonFarms_idByFarm_id.${farmId}.seasonFarm_id`)\n          if (!seasonFarmId) {\n            console.log('No matching season farm found for farmId:', farmId, 'Cannot check if season fields farm has changed. Data:', fieldChange);\n          } else if (seasonField == null || seasonField.farm == null || seasonField.farm._id == null || (seasonFarmId != null && seasonField.farm._id != seasonFarmId)) {\n            data.farm = _.merge({}, data.farm, {_id: seasonFarmId});\n          }\n        }\n      }\n      if (_.isEmpty(data)) return;\n      requests.push(\n        { //Change season's field's name, boundary\n          tree,\n          data,\n          type: 'application/vnd.oada.field.1+json',\n          path: `/bookmarks/seasons/2019/fields/${fieldChange.fieldId}` //TODO year\n        }\n      )\n    })\n    if (requests.length == 0) return;\n    await actions.app.oada.put({requests, connection_id})\n  },\n  async changeSeasonFarms({state, actions}, changed) {\n    /*\n      Apply any changes to season farms\n    */\n    const myState = state.app.OADAManager;\n    const {currentConnection: connection_id} = myState;\n    //See if they match season fields.\n    let requests = [];\n    let seasonFarms = state.app.seasonFarms;\n    _.forEach(changed, (change) => {\n      if (change.farmId == null) return;\n      let data = {};\n      let seasonFarm = seasonFarms[change.farmId]\n      //Check if name changed\n      if (change.name) {\n        if (seasonFarm == null || seasonFarm.name != change.name) {\n          data.name = change.name;\n        }\n      }\n      if (_.isEmpty(data)) return;\n      requests.push(\n        { //Change season's farms's name\n          tree,\n          data,\n          type: 'application/vnd.oada.farm.1+json',\n          path: `/bookmarks/seasons/2019/farms/${change.farmId}` //TODO year\n        }\n      )\n    })\n    if (requests.length == 0) return;\n    await actions.app.oada.put({requests, connection_id})\n  },\n  async deleteSeasonFields({state, actions}, deleted) {\n    console.log('delete season fields', deleted);\n    const myState = state.app.OADAManager;\n    const {currentConnection: connection_id} = myState;\n    //See if they match season fields.\n    let requests = [];\n    let seasonFields = state.app.seasonFields;\n    _.forEach(deleted, (fieldId) => {\n      let seasonField = seasonFields[fieldId]\n      if (!seasonField) return;\n      requests.push(\n        { //Change season's farms's name\n          tree,\n          type: 'application/vnd.oada.field.1+json',\n          path: `/bookmarks/seasons/2019/fields/${fieldId}` //TODO year\n        }\n      )\n    })\n    if (requests.length == 0) return;\n    await actions.app.oada.delete({requests, connection_id})\n  },\n  async deleteSeasonFarms({state, actions}, deleted) {\n    console.log('delete season farms', deleted);\n    const myState = state.app.OADAManager;\n    const {currentConnection: connection_id} = myState;\n    //See if they match season fields.\n    let requests = [];\n    let seasonFarms = state.app.seasonFarms;\n    _.forEach(deleted, (farmId) => {\n      let seasonFarm = seasonFarms[farmId]\n      if (!seasonFarm) return;\n      requests.push(\n        { //Change season's farms's name\n          tree,\n          type: 'application/vnd.oada.farm.1+json',\n          path: `/bookmarks/seasons/2019/farms/${farmId}` //TODO year\n        }\n      )\n    })\n    if (requests.length == 0) return;\n    await actions.app.oada.delete({requests, connection_id})\n  },\n  async login({actions, state}, {domain, token}) {\n    const myState = state.app.OADAManager;\n    const myActions = actions.app.OADAManager;\n    myState.domain = domain;\n    const {error} = await myActions.connect({domain, token});\n    if (!error) {\n      await myActions.getUserInfo();\n      await myActions.fetchAndWatch();\n      await myActions.initSeasonFarms();\n      await myActions.initSeasonFields();\n      await actions.view.Map.zoomBounds();\n    }\n  },\n  async onFieldChanged({state, actions}, props) {\n    /*\n      If a farm/field in the master list changed, apply change to this years season fields\n    */\n    console.log('onFieldChanged', props);\n    const myActions = actions.app.OADAManager;\n    let changeType = _.get(props, 'response.change.type');\n    if (changeType == 'merge' || changeType == 'delete') {\n      let deleted = false;\n      const wasDelete = _.get(props, 'response.change.wasDelete');\n      if (changeType == 'deleted' || wasDelete) deleted = true;\n      let fieldsChanged = [];\n      let fieldsDeleted = [];\n      _.forEach(_.get(props, 'response.change.body.data.fields'), (obj, key) => {\n        if (key == 'undefined') {\n          console.log('WARNING: Received a bad field change from OADA', props);\n          return; //TODO temp fix for oada changes being wrong\n        }\n        if (deleted) {\n          fieldsDeleted.push(key);\n        } else {\n          fieldsChanged.push({fieldId: key, deleted, name: _.get(obj, 'name'), boundary: _.get(obj, 'boundary')});\n        }\n      })\n      if (fieldsDeleted.length > 0) myActions.deleteSeasonFields(fieldsDeleted);\n      if (fieldsChanged.length > 0) myActions.changeSeasonFields(fieldsChanged);\n      let farmsChanged = [];\n      let farmsDeleted = [];\n      _.forEach(_.get(props, 'response.change.body.data.farms'), (obj, key) => {\n        if (key == 'undefined') {\n          console.log('WARNING: Received a bad farm change from OADA', props);\n          return; //TODO temp fix for oada changes being wrong\n        }\n        if (deleted) {\n          farmsDeleted.push(key);\n        } else {\n          farmsChanged.push({farmId: key, deleted, name: _.get(obj, 'name')});\n        }\n      })\n      if (farmsDeleted.length > 0) myActions.deleteSeasonFarms(farmsDeleted);\n      if (farmsChanged.length > 0) myActions.changeSeasonFarms(farmsChanged);\n    } else {\n      console.warn(\"onFieldChanged: Unsupported change type:\", changeType)\n    }\n  },\n  onSeasonsChanged({state, actions}, props) {\n\n  }\n}\n","import _state from './state'\nimport _actions from './actions'\n\nexport const state = _state;\nexport const actions = _actions;\n","import _state from './state'\nimport _actions from './actions'\n\nimport * as OADAManager from './OADAManager'\nimport oadaCacheOvermind from '@oada/oada-cache-overmind'\n\nconst oada =  oadaCacheOvermind('app.oada')\n\nexport const state = {\n  oada: oada.state,\n  OADAManager: OADAManager.state,\n  ..._state\n};\nexport const actions = {\n  oada: oada.actions,\n  OADAManager: OADAManager.actions,\n  ..._actions\n}\nexport const effects = {\n  oada: oada.effects\n}\n","import { createHook } from \"overmind-react\"\n\nimport { namespaced } from 'overmind/config'\n\nimport * as view from './view'\nimport * as app from './app'\n\nexport const config = namespaced({\n  view,\n  app,\n})\n\nexport default createHook()\n","import React from 'react';\n\n/** @jsx jsx */\nimport { jsx, css } from '@emotion/core'\nimport _ from 'lodash'\nimport overmind from '../../overmind'\nimport { Input, Button, Form, Dropdown } from 'semantic-ui-react'\n\nfunction Login() {\n  const { state, actions } = overmind();\n  const myState = state.view.Login;\n  const myActions = actions.view.Login;\n\n  return (\n    <div css={css`\n      height: 100vh;\n      width: 100vw;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      background: url(imgs/login-background.jpg) no-repeat center center fixed;\n      background-size: cover;\n    `}>\n      <div css={css`\n        width: 400px;\n        display: flex;\n        flex-direction: column;\n        background: #fff;\n        padding: 15px;\n        padding-top: 7px;\n        border-radius: 5px;\n      `}>\n        <img css={{\n          height: 300\n        }} src={`imgs/logo2.svg`} alt={'logo'} />\n        <Form css={css`\n          display: flex;\n          flex-direction: column;\n        `} onSubmit={myActions.login}>\n          <Input placeholder='OADA Domain...' value={myState.domain} onChange={(evt, data) => myActions.domainChange(data)} />\n          <Button\n            style={{marginTop: 7}} primary\n            loading={myState.loading}\n            disabled={myState.loading}>\n            Connect to Your OADA Cloud\n          </Button>\n          <Button\n            style={{marginTop: 7}}\n            onClick={myActions.viewDemo}\n            disabled={myState.loading}>\n            View Demo\n          </Button>\n        </Form>\n      </div>\n      <a css={css`\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        font-size: 1.2em;\n        color: #FFFFFF;\n        cursor: pointer;\n      `} onClick={myActions.logout}\n      >Logout</a>\n    </div>\n  );\n}\n\nexport default Login;\n","/*\n  Adds points/polygons to map when drawing a boundary\n*/\nimport React, { Component } from 'react';\nimport { Marker, Polygon, LayerGroup } from 'react-leaflet'\n\nimport overmind from '../../../overmind'\nimport _ from 'lodash';\n\nexport default function BoundaryDrawing() {\n  const {state, actions} = overmind();\n  const myState = state.view.Map.BoundaryDrawing;\n  const myActions = actions.view.Map.BoundaryDrawing;\n\n  const { boundary, drawing } = myState;\n  const { onMarkerMove } = myActions;\n\n  if (!drawing) return null;\n  return (\n    <LayerGroup>\n      <Polygon positions={_.map(boundary)} />\n      {_.map(boundary, (latlng, id) => <Marker position={latlng} key={id} draggable onMove={({latlng, oldLatLng}) => onMarkerMove({latlng, oldLatLng, id})}/>)}\n    </LayerGroup>\n  );\n}\n","/*\n  Adds points/polygons to map when drawing a boundary\n*/\nimport React from 'react';\nimport { Marker, Polygon, LayerGroup, GeoJSON } from 'react-leaflet'\n\nimport overmind from '../../../overmind'\n\nimport _ from 'lodash';\nimport uuid from 'uuid/v1'\n\nexport default function Fields() {\n  const {state, actions} = overmind();\n  const myState = state.view.Map;\n  const myActions = actions.view.Map;\n\n  const { fields } = myState;\n  const { onFieldClick } = myActions;\n\n  if (_.keys(fields).length == 0) return null;\n  return (\n    <LayerGroup>\n      {_.map(fields, (field, id) =>\n        <GeoJSON\n          bubblingMouseEvents={false}\n          style={field.style}\n          data={field.boundary}\n          key={uuid()} //Must be uuid to unmount/mount when field style or boundary changes\n          onClick={(evt) => {onFieldClick({id})}} />\n      )}\n    </LayerGroup>\n  );\n}\n","import React, {useEffect, useRef}  from 'react';\nimport { Map as LeafletMap, Marker, Popup, TileLayer, ZoomControl } from 'react-leaflet'\nimport './index.css'\n\nimport overmind from '../../overmind'\nimport _ from 'lodash'\nimport BoundaryDrawing from './BoundaryDrawing'\nimport Fields from './Fields'\n\nexport default function Map() {\n  const { actions, state } = overmind();\n  const myActions = actions.view.Map;\n  const myState = state.view.Map;\n\n  return (\n      <LeafletMap bounds={myState.bounds} center={myState.center} zoom={myState.zoom} onClick={(evt) => myActions.onMapClick({...evt.latlng})} zoomControl={false}>\n        <TileLayer\n          url=\"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\"\n          attribution=\"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\"\n        />\n        <TileLayer\n          url=\"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}{r}.png\"\n          minZoom={0}\n          maxZoom={20}\n          attribution=\"\"\n        />\n        <BoundaryDrawing />\n        <Fields />\n      </LeafletMap>\n  );\n}\n","import React from 'react';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Button from '@material-ui/core/Button';\nimport {TextInput, View} from 'react-native'\n\nimport overmind from '../../../overmind'\n\nexport default function DrawingToolbar() {\n  const { actions } = overmind();\n  const myActions = actions.view.TopBar;\n  return (\n    <Toolbar>\n      <View style={{flex: 1}} />\n      <Button color=\"inherit\" onClick={() => myActions.onCancelField()}>Cancel</Button>\n      <Button color=\"inherit\" onClick={() => myActions.onSaveField()}>Save</Button>\n    </Toolbar>\n  );\n}\n","import React from 'react'\nimport { Dropdown, Input } from 'semantic-ui-react'\nimport {View, Text} from 'react-native'\nimport _ from 'lodash'\n/*const tagOptions = [\n  {\n    text: 'Important',\n    value: 'Important',\n    label: { color: 'red', empty: true, circular: true },\n  }\n]*/\n\nimport overmind from '../../../../overmind'\n\nexport default function OperationsDropdown({style}) {\n  const { actions, state } = overmind();\n  const myActions = actions.view.TopBar.OperationDropdown;\n  const myState = state.view.TopBar.OperationDropdown;\n\n  const selectedOperation = myState.selectedOperation;\n  const operations = myState.list;\n  const open = myState.open;\n  const search = myState.search;\n  const onAdd = myActions.onAdd;\n  const onChange = myActions.onChange;\n  const onOpenChange = myActions.onOpenChange;\n  const onSearch = myActions.onSearch;\n\n  return (\n    <View style={style}>\n      <View style={{flexDirection: 'row'}}>\n        {\n           selectedOperation ?\n            <Dropdown\n              open={open}\n              onOpen={() => {onOpenChange({open: true})}}\n              onBlur={() => {onOpenChange({open: false})}}\n              text={selectedOperation.name}\n              icon='cog'\n              floating\n              labeled\n              button\n              className='icon'\n            >\n              <Dropdown.Menu style={{top: 42}}>\n                <Dropdown.Item style={{textAlign: 'center'}} text='Add New Operation' value='Add New Operation' onClick={(evt, data)=>{onAdd()}} />\n                <Input icon='search' iconPosition='left' className='search' style={{marginTop: 3}} value={search} onChange={(evt)=>{onSearch({search: evt.target.value})}} />\n                <Dropdown.Menu scrolling>\n                  {_.map(operations, option => (\n                    <Dropdown.Item key={option.value} {...option} onClick={(evt, data)=>{onChange({id: data.value})}} />\n                  ))}\n                </Dropdown.Menu>\n              </Dropdown.Menu>\n            </Dropdown>\n          :\n            <Dropdown\n              onClick={() => {onAdd()}}\n              open={false}\n              text={'Add New Operation'}\n              icon='cog'\n              floating\n              labeled\n              button\n              className='icon' />\n        }\n        <View style={{flex: 1}} />\n      </View>\n    </View>\n  )\n}\n","import React from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport MoreIcon from '@material-ui/icons/MoreHoriz';\nimport {View} from 'react-native'\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nimport overmind from '../../../../overmind'\n\nexport default function MoreDropdown({style}) {\n  const { actions, state } = overmind();\n  const myActions = actions.view.TopBar;\n\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  function handleClick(event) {\n    setAnchorEl(event.currentTarget);\n  }\n  function handleClose() {\n    setAnchorEl(null);\n  }\n  return (\n    <View style={style}>\n      <IconButton edge=\"end\" color=\"inherit\" aria-label=\"Menu\" onClick={handleClick}>\n        <MoreIcon  />\n      </IconButton>\n      <Menu\n        style={{top: 50, right: 5}}\n        open={Boolean(anchorEl)}\n        keepMounted\n        anchorEl={anchorEl}\n        onClose={handleClose}>\n          <MenuItem onClick={()=>{handleClose(); myActions.onAddField()}}>Add Field</MenuItem>\n          {\n            !state.view.FieldDetails.open ? null :\n            <MenuItem onClick={()=>{handleClose(); myActions.onEditField()}}>Edit Field</MenuItem>\n          }\n          <MenuItem onClick={()=>{handleClose(); myActions.onLogout()}}>Logout</MenuItem>\n          {/*<MenuItem onClick={()=>{handleClose(); myActions.onResetCache()}}>Reset Cache</MenuItem>*/}\n      </Menu>\n    </View>\n  );\n}\n","import React from \"react\";\nimport { geolocated } from \"react-geolocated\";\nimport Button from './Button';\n\nexport default geolocated({\n    positionOptions: {\n        enableHighAccuracy: true,\n    },\n    userDecisionTimeout: 5000,\n})(Button);\n","import React, {useEffect} from 'react'\n\nimport IconButton from '@material-ui/core/IconButton';\nimport MyLocation from '@material-ui/icons/MyLocation';\nimport {View} from 'react-native'\n\nimport _ from 'lodash'\nimport overmind from '../../../../overmind'\n\nexport default function Button({coords, isGeolocationAvailable, isGeolocationEnabled}) {\n  const { actions } = overmind();\n  const myActions = actions.view.TopBar;\n\n  useEffect(() => {\n    myActions.onLocationChange(coords);\n  });\n\n  return (\n    <View>\n      <IconButton edge=\"end\" color=\"inherit\" aria-label=\"Menu\" onClick={()=>{myActions.onMyLocationClick(coords)}}>\n        <MyLocation  />\n      </IconButton>\n    </View>\n  )\n}\n","import React from 'react';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Button from '@material-ui/core/Button';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport ListIcon from '@material-ui/icons/Menu';\n\nimport OperationDropdown from './OperationDropdown';\nimport MoreDropdown from './MoreDropdown';\nimport MyLocation from './MyLocation';\n\nexport default function NormalToolbar({toggleTitle}) {\n  return (\n    <Toolbar>\n      {/*<IconButton edge=\"start\" style={{marginRight: 7}} color=\"inherit\" aria-label=\"Menu\" onClick={()=>{console.log('TODO Menu Pressed')}}>\n        <ListIcon />\n      </IconButton>*/}\n      <OperationDropdown style={{flex: 1}} />\n      {/*<Button color=\"inherit\">2019</Button>*/}\n      <MyLocation />\n      <MoreDropdown />\n    </Toolbar>\n  );\n}\n","import React, {Component} from 'react';\nimport AppBar from '@material-ui/core/AppBar';\nimport {View} from 'react-native'\n\nimport DrawingToolbar from './DrawingToolbar';\nimport NormalToolbar from './NormalToolbar';\n\nimport overmind from '../../overmind'\n\nexport default function TopBar() {\n  const {state} = overmind();\n  const drawing = state.view.Map.BoundaryDrawing.drawing;\n  return (\n    <View style={{zIndex: 1201}}>\n      <AppBar position=\"static\">\n        {\n          drawing ? <DrawingToolbar /> : <NormalToolbar />\n        }\n      </AppBar>\n    </View>\n  );\n}\n","import React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Drawer from '@material-ui/core/Drawer';\nimport Button from '@material-ui/core/Button';\nimport List from '@material-ui/core/List';\nimport Divider from '@material-ui/core/Divider';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport InboxIcon from '@material-ui/icons/MoveToInbox';\nimport MailIcon from '@material-ui/icons/Mail';\nimport { Text, View } from 'react-native';\n\nexport default function TemporaryDrawer() {\n  return (\n    <Drawer open={false} variant=\"persistent\">\n      <View style={{height: 64}} />\n      <div\n        style={{width: 250}}\n        role=\"presentation\">\n        <List>\n          {['Inbox', 'Starred', 'Send email'].map((text, index) => (\n            <ListItem button key={text}>\n              <ListItemIcon>{index % 2 === 0 ? <InboxIcon /> : <MailIcon />}</ListItemIcon>\n              <ListItemText primary={text} />\n            </ListItem>\n          ))}\n        </List>\n        <Divider />\n        <List>\n          {['All mail', 'Trash', 'Spam'].map((text, index) => (\n            <ListItem button key={text}>\n              <ListItemIcon>{index % 2 === 0 ? <InboxIcon /> : <MailIcon />}</ListItemIcon>\n              <ListItemText primary={text} />\n            </ListItem>\n          ))}\n        </List>\n      </div>\n    </Drawer>\n  );\n}\n","import React from 'react';\nimport Drawer from '@material-ui/core/Drawer';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport {View, Text} from 'react-native';\nimport IconButton from '@material-ui/core/IconButton';\nimport EditIcon from '@material-ui/icons/Edit';\nimport _ from 'lodash';\nimport { Button } from 'semantic-ui-react'\n\n\nimport overmind from '../../overmind'\n\nexport default function FieldDetails() {\n  const {state, actions} = overmind();\n  const myState = state.view.FieldDetails;\n  const myActions = actions.view.FieldDetails;\n\n  let { open, field, farm, showAddOperationButton } = myState;\n  const { onStatusChange, onEditFieldClick, onAddNewOperationClick } = myActions;\n\n  if (!Boolean(field)) {\n    open = false;\n    field = {};\n  }\n  return (\n    <Drawer anchor=\"bottom\" open={open} variant=\"persistent\">\n      <View style={{paddingBottom: 20}}>\n        <View style={{flexDirection: 'column', alignItems: 'center'}}>\n          <View style={{justifyContent: 'left', flexDirection: 'row', alignItems: 'center', marginTop: 10}}>\n              <Text style={{fontWeight: 'bold', fontSize: 20}}>\n                {field.name}\n              </Text>\n              <Text style={{marginLeft: 7, fontSize: 18}}>\n                {`- ${Math.round(field.acres)} ac`}\n              </Text>\n          </View>\n          {\n            farm == null ? null :\n            <Text style={{fontSize: 15, color: '#999', marginTop: 2, marginBottom: 7}}>\n              {farm.name}\n            </Text>\n          }\n        </View>\n        <View style={{justifyContent: 'center', flexDirection: 'row'}}>\n          {\n            showAddOperationButton ?\n              <Button style={{marginTop: 15}} onClick={() => myActions.onAddNewOperationClick()}>Add New Operation</Button>\n            :\n            <FormControl component=\"fieldset\">\n              <FormGroup aria-label=\"position\" name=\"position\" row>\n                <FormControlLabel\n                  value=\"bottom\"\n                  control={<Checkbox color=\"primary\" checked={(field.status == \"planned\") || false} onChange={()=>{onStatusChange({status: 'planned'})}} />}\n                  label=\"Planned\"\n                  labelPlacement=\"bottom\"\n                />\n                <FormControlLabel\n                  value=\"bottom\"\n                  control={<Checkbox color=\"primary\" checked={(field.status == \"started\") || false} onChange={()=>{onStatusChange({status: 'started'})}} />}\n                  label=\"Started\"\n                  labelPlacement=\"bottom\"\n                />\n                <FormControlLabel\n                  value=\"bottom\"\n                  control={<Checkbox color=\"primary\" checked={(field.status == \"done\") || false} onChange={()=>{onStatusChange({status: 'done'})}} />}\n                  label=\"Done\"\n                  labelPlacement=\"bottom\"\n                />\n              </FormGroup>\n            </FormControl>\n          }\n        </View>\n      </View>\n    </Drawer>\n  );\n}\n","import React from 'react';\nimport { Text, View } from 'react-native';\n\nexport default function AcresPlanned({acresStatus}) {\n  return (\n    <View style={{backgroundColor: '#c50003', paddingLeft: 7, paddingRight: 7, paddingTop: 5, paddingBottom: 5, borderRadius: 5}}>\n      <Text style={{color: 'white', textShadowColor: '#000', textShadowOffset: {width: 1, height: 1}, textShadowRadius: 2}}>\n        {`${acresStatus.planned} ac (${acresStatus.plannedPercentage}%)`}\n      </Text>\n    </View>\n  );\n}\n","import React from 'react';\nimport { Text, View } from 'react-native';\n\nexport default function AcresStarted({acresStatus}) {\n  return (\n    <View style={{backgroundColor: '#eeb705', paddingLeft: 7, paddingRight: 7, paddingTop: 5, paddingBottom: 5, borderRadius: 5, marginRight: 7, marginLeft: 7}}>\n      <Text style={{color: 'white', textShadowColor: '#000', textShadowOffset: {width: 1, height: 1}, textShadowRadius: 2}}>\n        {`${acresStatus.started} ac (${acresStatus.startedPercentage}%)`}\n      </Text>\n    </View>\n  );\n}\n","import React from 'react';\nimport { Text, View } from 'react-native';\n\nexport default function AcresDone({acresStatus}) {\n  return (\n    <View style={{backgroundColor: '#5bb25f', paddingLeft: 7, paddingRight: 7, paddingTop: 5, paddingBottom: 5, borderRadius: 5}}>\n      <Text style={{color: 'white', textShadowColor: '#000', textShadowOffset: {width: 1, height: 1}, textShadowRadius: 2}}>\n        {`${acresStatus.done} ac (${acresStatus.donePercentage}%)`}\n      </Text>\n    </View>\n  );\n}\n","import React, { Component } from 'react';\nimport { Text, View } from 'react-native';\n\nimport AcresPlanned from './AcresPlanned'\nimport AcresStarted from './AcresStarted'\nimport AcresDone from './AcresDone'\n\nimport overmind from '../../overmind'\n\nexport default function AcresStatus() {\n  const {state} = overmind();\n  const acresStatus = state.app.acresStatus;\n  const selectedOperationId = state.view.TopBar.OperationDropdown.selectedOperationId;\n  if (!selectedOperationId) return null;\n  return (\n    //z-index of leaflet map is 400\n    <View style={{position: \"absolute\", display: \"flex\", flexDirection: 'row', justifyContent: \"center\", alignItems: \"center\", top: 68, zIndex: 401, width: '100vw'}}>\n      <AcresPlanned acresStatus={acresStatus} />\n      <AcresStarted acresStatus={acresStatus} />\n      <AcresDone acresStatus={acresStatus} />\n    </View>\n  );\n}\n","import React from 'react';\nimport {View, Text} from 'react-native'\nimport { Form, Button, Modal, Input, Dropdown, Icon } from 'semantic-ui-react'\n\nimport overmind from '../../overmind'\n\nexport default function SaveField() {\n  const {state, actions} = overmind();\n  const myState = state.view.Modals.SaveField;\n  const myActions = actions.view.Modals.SaveField;\n\n  const open = myState.open;\n  const name = myState.name;\n  const onNameChange = myActions.onNameChange;\n  const onCancel = myActions.onCancel;\n  const onSave = myActions.onSave;\n  const [farmOpen, setFarmOpen] = React.useState(false);\n\n  const farm = myState.farm || {};\n  const farmOptions = myState.farms;\n\n  return (\n    <Modal open={myState.open} size='tiny'>\n      <Modal.Header>\n        {(state.view.Map.editingField) ? 'Edit Field' : 'New Field'}\n      </Modal.Header>\n      <Modal.Content>\n        <View style={{flexDirection: 'column', zIndex: 1}}>\n          <Text style={{marginBottom: 7}}>Field Name:</Text>\n          <Form onSubmit={() => onSave()}>\n            <Input autoFocus placeholder='Back 40' value={name} onChange={(evt) => {onNameChange({name: evt.target.value})}} />\n          </Form>\n          <Text style={{marginBottom: 7, marginTop: 15}}>Farm:</Text>\n          <Dropdown\n            trigger={\n              <View style={{paddingLeft: 13, paddingRight: 7, border: '1px solid rgba(34,36,38,.15)', borderRadius: '.28571429rem', height: 38, flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between'}}>\n                <Text style={{color: (farm.name ? 'rgba(0,0,0,.87)' : 'rgba(0,0,0,.25)')}}>\n                  {farm.name || 'Select a farm'}\n                </Text>\n                <Icon name='caret down' style={{paddingBottom: 17}}/>\n              </View>\n            }\n            icon={null}\n            onOpen={() => {setFarmOpen(true)}}\n            onBlur={() => {setFarmOpen(false)}}\n            open={farmOpen}>\n            <Dropdown.Menu style={{overflow: 'hidden', maxHeight: '50vh'}}>\n              <Dropdown.Item style={{textAlign: 'center'}} text='Add New Farm' value='Add New Farm' onClick={(evt, data)=>{myActions.onFarmAdd(); setFarmOpen(false);}} />\n              <Input icon='search' iconPosition='left' className='search' value={myState.farmSearch} onChange={(evt)=>{myActions.onFarmSearchChange(evt.target.value)}} />\n              <Dropdown.Menu scrolling>\n                {farmOptions.map((option) => (\n                  <Dropdown.Item key={option.value} {...option} onClick={() => {myActions.onFarmChange({id: option.value}); setFarmOpen(false);}} />\n                ))}\n              </Dropdown.Menu>\n            </Dropdown.Menu>\n          </Dropdown>\n        </View>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button negative onClick={() => onCancel()}>Cancel</Button>\n        <Button positive icon='checkmark' labelPosition='right' content='Save' onClick={() => onSave()} />\n      </Modal.Actions>\n    </Modal>\n  );\n}\n","import React from 'react';\nimport {View, Text} from 'react-native'\nimport { Button, Modal, Input } from 'semantic-ui-react'\n\nimport overmind from '../../overmind'\n\nexport default function OADADomain() {\n  const {state, actions} = overmind();\n  const myState = state.view.Modals.OADADomain;\n  const myActions = actions.view.Modals.OADADomain;\n\n  const { open, domain } = myState;\n  const { onDomainChange, onCancel, onConnect } = myActions;\n\n  return (\n    <Modal open={open} size='tiny'>\n      <Modal.Header>Connect to OADA Server</Modal.Header>\n      <Modal.Content>\n        <Text>Domain:</Text>\n        <View style={{flexDirection: 'row'}}>\n          <Input style={{flex: 1, marginTop: 7}} placeholder='https://oada.openatk.com' value={domain} onChange={(evt) => {onDomainChange({domain: evt.target.value})}} />\n        </View>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button negative onClick={() => onCancel()}>Cancel</Button>\n        <Button positive icon='checkmark' labelPosition='right' content='Connect' onClick={() => onConnect({})} />\n      </Modal.Actions>\n    </Modal>\n  );\n}\n","import React from 'react';\nimport {View, Text} from 'react-native'\nimport { Button, Modal, Input, Form } from 'semantic-ui-react'\n\nimport overmind from '../../overmind'\n\nexport default function NewOperation() {\n  const {state, actions} = overmind();\n  const myState = state.view.Modals.NewOperation;\n  const myActions = actions.view.Modals.NewOperation;\n\n  const { open, name } = myState;\n  const { onNameChange, onCancel, onSave } = myActions;\n\n  return (\n    <Modal open={open} size='tiny'>\n      <Modal.Header>New Operation</Modal.Header>\n      <Modal.Content>\n        <Text>Name:</Text>\n        <View style={{flexDirection: 'row'}}>\n          <Form style={{flex: 1}} onSubmit={onSave}>\n            <Input autoFocus style={{width: '100%', marginTop: 7}} placeholder='Corn Planting' value={name} onChange={(evt) => {onNameChange({name: evt.target.value})}} />\n          </Form>\n        </View>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button negative onClick={() => onCancel()}>Cancel</Button>\n        <Button positive icon='checkmark' labelPosition='right' content='Save' onClick={() => onSave()} />\n      </Modal.Actions>\n    </Modal>\n  );\n}\n","import React from 'react';\nimport {View, Text} from 'react-native'\nimport { Button, Modal, Input } from 'semantic-ui-react'\n\nimport overmind from '../../overmind'\n\nexport default function NewFarm() {\n  const {state, actions} = overmind();\n  const myState = state.view.Modals.NewFarm;\n  const myActions = actions.view.Modals.NewFarm;\n\n  const { open, name } = myState;\n  const { onNameChange, onCancel, onSave } = myActions;\n\n  return (\n    <Modal open={open} size='tiny'>\n      <Modal.Header>New Farm</Modal.Header>\n      <Modal.Content>\n        <Text>Name:</Text>\n        <View style={{flexDirection: 'row'}}>\n          <Input style={{flex: 1, marginTop: 7}} placeholder='Bowman Farms' value={name} onChange={(evt) => {onNameChange({name: evt.target.value})}} />\n        </View>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button negative onClick={() => onCancel()}>Cancel</Button>\n        <Button positive icon='checkmark' labelPosition='right' content='Save' onClick={() => onSave()} />\n      </Modal.Actions>\n    </Modal>\n  );\n}\n","import React from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nimport Login from './Login'\nimport Map from './Map'\nimport TopBar from './TopBar'\nimport FieldList from './FieldList'\nimport FieldDetails from './FieldDetails'\nimport AcresStatus from './AcresStatus'\n\nimport ModalSaveField from './Modals/SaveField';\nimport ModalOADADomain from './Modals/OADADomain';\nimport ModalNewOperation from './Modals/NewOperation';\nimport ModalNewFarm from './Modals/NewFarm';\n\nimport overmind from '../overmind'\n\nfunction App() {\n  const { state } = overmind();\n\n  if (!state.view.Login.loggedIn) {\n    return <Login />\n  }\n\n  return (\n    <div className=\"App\">\n\n      <TopBar />\n      <AcresStatus />\n      <Map />\n      <FieldList />\n      <FieldDetails />\n      <ModalSaveField />\n      <ModalOADADomain />\n      <ModalNewOperation />\n      <ModalNewFarm />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport * as serviceWorker from './serviceWorker';\n\nimport './index.css';\n\nimport App from './view/App'\n\nimport { createOvermind } from \"overmind\";\nimport { Provider } from \"overmind-react\";\nimport { config } from './overmind'\n\nconst app = createOvermind(config,\n{\n  devtools: true,\n});\n\nReactDOM.render(\n  <Provider value={app}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = _default;\n\nvar _state = _interopRequireDefault(require(\"./state\"));\n\nvar _actions = _interopRequireDefault(require(\"./actions\"));\n\nvar _effects = _interopRequireDefault(require(\"./effects\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _default(namespace) {\n  return {\n    state: _state.default,\n    effects: _effects.default,\n    actions: (0, _actions.default)(namespace)\n  };\n}","module.exports = __webpack_public_path__ + \"static/media/logo.5d5d9eef.svg\";","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _default = {\n  connections: {}\n};\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = _default;\n\nvar _bluebird = _interopRequireDefault(require(\"bluebird\"));\n\nvar _url = _interopRequireDefault(require(\"url\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconsole.log('oada-cache-overmind: 1');\nvar namespace = null;\n\nfunction ns(context) {\n  return _lodash.default.mapValues(context, obj => {\n    if (namespace == null) return obj;\n    return _lodash.default.get(obj, namespace);\n  });\n}\n\nfunction domainToConnectionId(domainUrl) {\n  var domain = _url.default.parse(domainUrl).hostname;\n\n  return domain.replace(/\\./g, '_');\n}\n\nfunction _default(_namespace) {\n  namespace = _namespace;\n  return {\n    connect(context, props) {\n      var {\n        state,\n        effects\n      } = ns(context);\n      var connectionId = props.connection_id || domainToConnectionId(props.domain);\n      return effects.connect({\n        connection_id: connectionId,\n        domain: props.domain,\n        options: props.options,\n        cache: props.cache,\n        token: props.token,\n        websocket: props.websocket\n      }).then(response => {\n        if (state[connectionId] == null) state[connectionId] = {};\n        state[connectionId].token = response.token;\n        state[connectionId].domain = props.domain; //Clear bookmarks if exist\n\n        if (state[connectionId].bookmarks) state[connectionId].bookmarks = {};\n        state.isAuthenticated = true;\n        return {\n          token: response.token,\n          connectionId\n        };\n      }).catch(error => {\n        state.error = {\n          error: error.message\n        };\n        state.isAuthenticated = false;\n        return {\n          error\n        };\n      });\n    },\n\n    handleWatch(context, props) {\n      var {\n        state,\n        effects\n      } = ns(context);\n      var nullPath = null;\n\n      if (props.nullPath) {\n        nullPath = props.nullPath.split('/');\n        nullPath.shift();\n        nullPath.shift();\n        nullPath = nullPath.join('.');\n      }\n\n      if (props.response.change.type === 'merge') {\n        var currentState = _lodash.default.get(state, \"\".concat(props.connection_id, \".\").concat(props.path));\n\n        var _oldState = _lodash.default.cloneDeep(currentState);\n\n        _lodash.default.merge(currentState, props.response.change.body.data);\n\n        if (props.response.change.wasDelete && nullPath) {\n          var deletePath = \"\".concat(props.path, \".\").concat(nullPath);\n\n          _lodash.default.unset(state, \"\".concat(props.connection_id, \".\").concat(deletePath));\n        }\n\n        return {\n          oldState: _oldState\n        };\n      } else if (props.response.change.type === 'delete') {\n        var oldState = _lodash.default.cloneDeep(_lodash.default.get(state, \"\".concat(props.connection_id, \".\").concat(props.path)));\n\n        if (nullPath) {\n          var _deletePath = \"\".concat(props.path, \".\").concat(nullPath);\n\n          _lodash.default.unset(state, \"\".concat(props.connection_id, \".\").concat(_deletePath));\n        }\n\n        return {\n          oldState\n        };\n      } else {\n        console.warn('oada-cache-overmind - UNKNOWN CHANGE TYPE:', props);\n      }\n    },\n\n    get(context, props) {\n      var {\n        state,\n        effects,\n        actions\n      } = ns(context);\n      if (!props.requests) throw new Error('Missing requests. Please pass requests in as an array of request objects under the requests key');\n      var requests = props.requests || [];\n      var PromiseMap = props.concurrent ? _bluebird.default.map : _bluebird.default.mapSeries;\n      return PromiseMap(requests, (request, i) => {\n        if (request.complete) return;\n\n        var _statePath = request.path.replace(/^\\//, '').split('/').join('.');\n\n        if (request.watch) {\n          var conn = state[request.connection_id || props.connection_id];\n\n          if (conn) {\n            if (conn && conn.watches && conn.watches[request.path]) return;\n            request.watch.actions = [actions.handleWatch, ...request.watch.actions];\n            request.watch.payload = request.watch.payload || {};\n            request.watch.payload.connection_id = request.connection_id || props.connection_id;\n            request.watch.payload.path = _statePath;\n          }\n        }\n\n        return effects.get({\n          connection_id: request.connection_id || props.connection_id,\n          url: request.url,\n          path: request.path,\n          headers: request.headers,\n          watch: request.watch,\n          tree: request.tree || props.tree\n        }).then(response => {\n          var _responseData = response.data; //Build out path one object at a time.\n\n          var path = \"\".concat(request.connection_id || props.connection_id, \".\").concat(_statePath); //Set response\n\n          if (_responseData) _lodash.default.set(state, path, _responseData);\n\n          if (request.watch) {\n            path = \"\".concat(request.connection_id || props.connection_id, \".watches.\").concat(request.path);\n\n            _lodash.default.set(state, path, true);\n          }\n\n          requests[i].complete = true;\n          return response;\n        }).catch(error => {\n          return _objectSpread({\n            error\n          }, error.response);\n        });\n      }).then(responses => {\n        return {\n          responses,\n          requests\n        };\n      });\n    },\n\n    put(context, props) {\n      var {\n        state,\n        effects,\n        actions\n      } = ns(context);\n      if (!props.requests) throw new Error(\"Missing requests. Please pass requests in as an array of request objects under the requests key\");\n      var requests = props.requests || [];\n      var PromiseMap = props.concurrent ? _bluebird.default.map : _bluebird.default.mapSeries;\n      return PromiseMap(requests, (request, i) => {\n        if (request.complete) return;\n        return effects.put({\n          url: request.url,\n          //props.domain + ((request.path[0] === '/') ? '':'/') + request.path,\n          path: request.path,\n          data: request.data,\n          type: request.type,\n          headers: request.headers,\n          tree: request.tree || props.tree,\n          connection_id: request.connection_id || props.connection_id\n        }).then(response => {\n          var path = \"\".concat(request.connection_id || props.connection_id).concat(request.path.split(\"/\").join(\".\"));\n\n          var oldState = _lodash.default.cloneDeep(_lodash.default.get(state, path));\n\n          var newState = _lodash.default.merge(oldState, request.data);\n\n          _lodash.default.set(state, path, newState);\n\n          requests[i].complete = true;\n          return response;\n        });\n      }).then(responses => {\n        return {\n          responses,\n          requests\n        };\n      });\n    },\n\n    post(context, props) {\n      var {\n        state,\n        effects,\n        actions\n      } = ns(context);\n      if (!props.requests) throw new Error(\"Missing requests. Please pass requests in as an array of request objects under the requests key\");\n      var requests = props.requests || [];\n      var PromiseMap = props.concurrent ? _bluebird.default.map : _bluebird.default.mapSeries;\n      return PromiseMap(requests, (request, i) => {\n        if (request.complete) return;\n        return effects.post({\n          url: request.url,\n          //props.domain + ((request.path[0] === '/') ? '':'/') + request.path,\n          path: request.path,\n          data: request.data,\n          type: request.type,\n          headers: request.headers,\n          tree: request.tree || props.tree,\n          connection_id: request.connection_id || props.connection_id\n        }).then(response => {\n          var id = response.headers.location; //TODO why is this here?\n\n          var path = \"\".concat(request.connection_id || props.connection_id).concat(request.path.split(\"/\").join(\".\"));\n\n          var oldState = _lodash.default.cloneDeep(_lodash.default.get(state, path));\n\n          var newState = _lodash.default.merge(oldState, request.data);\n\n          _lodash.default.set(state, path, newState);\n\n          requests[i].complete = true;\n          return;\n        });\n      }).then(responses => {\n        return {\n          responses\n        };\n      });\n    },\n\n    delete(context, props) {\n      var {\n        state,\n        effects,\n        actions\n      } = ns(context);\n      if (!props.requests) throw new Error(\"Missing requests. Please pass requests in as an array of request objects under the requests key\");\n      var requests = props.requests || [];\n      var PromiseMap = props.concurrent ? _bluebird.default.map : _bluebird.default.mapSeries;\n      return PromiseMap(requests, (request, i) => {\n        if (request.complete) return;\n        var connectionId = request.connection_id || props.connection_id;\n\n        var _statePath = request.path.replace(/^\\//, \"\").split(\"/\").join(\".\");\n\n        var conn = _lodash.default.get(state, connectionId);\n\n        if (request.unwatch && conn && conn.watches) {\n          // Don't send the unwatch request if it isn't being watched already.\n          if (!conn.watches[request.path]) return;\n        }\n\n        return effects.delete({\n          connection_id: connectionId,\n          url: request.url,\n          path: request.path,\n          headers: request.headers,\n          unwatch: request.unwatch,\n          type: request.type,\n          tree: request.tree || props.tree\n        }).then(response => {\n          //Handle watches index and optimistically update\n          if (request.unwatch && conn && conn.watches) {\n            _lodash.default.unset(state, \"\".concat(connectionId, \".watches.\").concat(request.path));\n          } else {\n            _lodash.default.unset(state, \"\".concat(connectionId, \".\").concat(_statePath));\n          }\n\n          requests[i].complete = true;\n          return response;\n        });\n      }).then(responses => {\n        return {\n          responses,\n          requests\n        };\n      });\n    },\n\n    disconnect(context, props) {\n      var {\n        state,\n        effects\n      } = ns(context);\n      return effects.disconnect({\n        connection_id: props.connection_id\n      });\n    },\n\n    resetCache(context, props) {\n      //Currently oada-cache resets all of the cache, not just the db for a single connection_id\n      var {\n        effects,\n        state\n      } = ns(context); //Connect if not connected\n\n      return effects.resetCache({\n        connection_id: props.connection_id || domainToConnectionId(props.domain)\n      });\n    }\n\n  };\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _oadaCache = _interopRequireDefault(require(\"@oada/oada-cache\"));\n\nvar _uuid = _interopRequireDefault(require(\"uuid\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar connections = {};\n\nvar connect = function connect(args) {\n  if (!args.connection_id) throw 'connection_id not supplied';\n  if (args.connection_id && connections[args.connection_id]) return Promise.resolve(connections[args.connection_id]);\n  return _oadaCache.default.connect(args).then(conn => {\n    conn.cache = {};\n    connections[args.connection_id] = conn;\n    return conn;\n  });\n};\n\nvar get = function get(args) {\n  if (!args.connection_id) throw 'connection_id not supplied';\n\n  if (args.watch && args.watch.actions) {\n    var actions = args.watch.actions;\n\n    args.watch.func = payload => {\n      actions.forEach(action => {\n        action(payload);\n      });\n    };\n  }\n\n  return connections[args.connection_id].get(args);\n};\n\nvar put = function put(args) {\n  if (!args.connection_id) throw 'connection_id not supplied';\n  return connections[args.connection_id].put(args);\n};\n\nvar post = function post(args) {\n  if (!args.connection_id) throw 'connection_id not supplied';\n  return connections[args.connection_id].post(args);\n};\n\nvar _delete = function _delete(args) {\n  if (!args.connection_id) throw 'connection_id not supplied';\n  return connections[args.connection_id].delete(args);\n};\n\nvar disconnect = function _disconnect(args) {\n  if (!args.connection_id) throw 'connection_id not supplied';\n  var connection = connections[args.connection_id];\n  connections[args.connection_id] = undefined;\n  return connection.disconnect();\n};\n\nvar resetCache = function resetCache(args) {\n  //Currently oada-cache resets all of the cache, not just the db for a single connection_id\n  return connections[args.connection_id].resetCache(args);\n};\n\nvar _default = {\n  connect,\n  get,\n  put,\n  post,\n  delete: _delete,\n  resetCache,\n  disconnect\n};\nexports.default = _default;","const Promise = require(\"bluebird\");\nlet setupCache = require(\"./cache\");\nconst uuid = require(\"uuid\");\nconst _ = require(\"lodash\");\nconst urlLib = require(\"url\");\nconst pointer = require(\"json-pointer\");\nconst ws = require(\"./websocket\");\nconst axios = require(\"axios\");\nconst _TOKEN = require(\"./token\");\n\n// debug\nconst error = require(\"debug\")(\"oada-cache:index:error\");\nconst info = require(\"debug\")(\"oada-cache:index:info\");\n\nlet dbprefix = \"\";\nconst setDbPrefix = pfx => (dbprefix = pfx);\n\nprocess.on('unhandledRejection', (reason, p) => {\n  console.log('------Unhandled Rejection - Fix Me!-------');\n  console.log(reason);\n});\n\nvar connect = async function connect({\n  domain,\n  options,\n  cache,\n  token,\n  websocket,\n}) {\n  if (!domain) {\n    throw new Error(\"domain undefined\");\n  }\n  if (typeof domain !== \"string\") {\n    throw new Error(\"domain must be a string\");\n  }\n  if (!options && !token) {\n    throw new Error(\"options and token undefined\");\n  }\n  if (token && typeof token !== \"string\") {\n    throw new Error(\"token must be a string\");\n  }\n  if (\n    cache !== undefined &&\n    typeof cache !== \"boolean\" &&\n    typeof cache !== \"object\"\n  ) {\n    throw new Error(\n      `cache must be either a boolean or an object with 'name' and/or 'expires' keys`,\n    );\n  }\n  if (cache && cache.name && typeof cache.name !== \"string\") {\n    throw new Error(\"cache name must be a string\");\n  }\n  //  if (typeof cache !== \"undefined\" && typeof cache !== \"boolean\")\n  //throw \"cache must be boolean\";\n  if (typeof websocket !== \"undefined\" && typeof websocket !== \"boolean\") {\n    throw new Error(\"websocket must be boolean\");\n  }\n\n  var CACHE;\n  var REQUEST = axios;\n  var NOCACHEREQUEST = axios;\n  var SOCKET;\n  var TOKEN;\n  let _token = new _TOKEN({ domain, token, options, dbprefix });\n  if (!domain) {\n    throw new Error(\"domain undefined\");\n  }\n  var DOMAIN = domain;\n  var NAME =\n    cache && cache.name\n      ? cache.name\n      : urlLib.parse(domain).hostname.replace(/\\./g, \"_\");\n  var EXPIRES = cache && cache.expires ? cache.expires : undefined;\n\n  function _replaceLinks(obj) {\n    let ret = Array.isArray(obj) ? [] : {};\n    if (!obj) {\n      return obj;\n    } // no defined objriptors for this level\n    return Promise.map(Object.keys(obj || {}), key => {\n      if (key === \"*\") {\n        // Don't put *s into oada. Ignore them\n        return;\n      }\n      let val = obj[key];\n      if (typeof val !== \"object\" || !val) {\n        ret[key] = val; // keep it asntType: 'application/vnd.oada.harvest.1+json'\n        return;\n      }\n      if (val._type) {\n        // If it has a '_type' key, don't worry about it.\n        //It'll get created in future iterations of ensureTree\n        return;\n      }\n      if (val._id) {\n        // If it's an object, and has an '_id', make it a link from descriptor\n        ret[key] = { _id: val._id };\n        if (\"_rev\" in val) {\n          ret[key]._rev = val._rev;\n        }\n        return;\n      }\n      // otherwise, recurse into the object looking for more links\n      return _replaceLinks(val).then(result => {\n        ret[key] = result;\n        return;\n      });\n    }).then(() => {\n      return ret;\n    });\n  }\n\n  async function _makeResourceAndLink({ path, data, headers }, waitTime) {\n    data._id = _.clone(data._id) || \"resources/\" + uuid();\n\n    let linkReq = {\n      path,\n      type: data._type,\n      headers,\n      data: { _id: data._id },\n    };\n    // Create a versioned link if the tree specifies one.\n    if (\"_rev\" in data) {\n      linkReq.data._rev = 0;\n    }\n    // We don't want to attempt to set the rev when we put the resource\n\n    let resReq = {\n      path: \"/\" + data._id,\n      type: data._type,\n      data,\n    };\n    var link;\n    try {\n      link = await put(linkReq);\n    } catch (err) {\n      if (err.response && err.response.status === 412) {\n        var pathPieces = path.split(\"/\");\n        var parentPath = pathPieces.splice(0, pathPieces.length - 1).join(\"/\");\n        // Wait time increases: 1s, 2s, 4s, 8s, 16s. Throw after 16s.\n        if (waitTime > 16000) {\n          throw err;\n        }\n        //The parent has been modified; attempt to get the new _rev\n        var response;\n        try {\n          response = await NOCACHEREQUEST({\n            method: \"get\",\n            url: DOMAIN + parentPath,\n            headers: { Authorization: \"Bearer \" + TOKEN },\n          });\n        } catch (erro) {\n          waitTime = waitTime || 1000;\n          await Promise.delay(waitTime);\n          return _makeResourceAndLink({ path, data, headers }, waitTime * 2);\n        }\n        // If the key has already been created, set the resource path to the bookmarks path and let it map automatically, not a resource id\n        if (response.data[pathPieces[pathPieces.length - 1]]) {\n          resReq.data._id =\n            response.data[pathPieces[pathPieces.length - 1]]._id;\n          resReq.path = \"/\" + resReq.data._id;\n          // Concurrent put, delete, put (delete.test.js #15) can produce situations where _id is undefined\n          if (!resReq.data._id) {\n            waitTime = waitTime || 1000;\n            await Promise.delay(waitTime);\n            var newHeaders = _.cloneDeep(headers);\n            //TODO: use if-match headers???\n            newHeaders[\"if-match\"] = parseInt(response.headers[\"x-oada-rev\"]);\n            return _makeResourceAndLink(\n              { path, data, headers: newHeaders },\n              waitTime * 2,\n            );\n          }\n        } else {\n          // The key does not yet exist, adjust the if-match and try again.\n          waitTime = waitTime || 1000;\n          await Promise.delay(waitTime);\n          var newHeaders = _.cloneDeep(headers);\n          newHeaders[\"if-match\"] = parseInt(response.headers[\"x-oada-rev\"]);\n          return _makeResourceAndLink(\n            { path, data, headers: newHeaders },\n            waitTime * 2,\n          );\n        }\n      } else {\n        throw err;\n      }\n    }\n    // Delete the _rev  and _id keys. No need for them in the resource object. They will break things.\n    if (\"_rev\" in data) {\n      delete resReq.data._rev;\n    }\n    var resource = await put(resReq);\n    return { link, resource };\n  }\n\n  function _watch({ headers, path, callback, payload }) {\n    if (SOCKET) {\n      return SOCKET.watch(\n        {\n          path,\n          headers,\n        },\n        async function handleWatchResponse(response) {\n          if (payload && payload.tree) {\n            // Filter the change body based on the given tree\n            info(\"BODY BEFORE\", path, payload.tree);\n            info(_.cloneDeep(response.change.body));\n            response.change.body = await _recursiveFilterChange(\n              DOMAIN + path,\n              payload.tree,\n              response.change.body,\n            );\n            info(\"BODY AFTER\");\n            info(response.change.body);\n          }\n          var watchPayload = _.cloneDeep(payload) || {};\n          watchPayload.response = response;\n          watchPayload.request = {\n            url: DOMAIN + path,\n            headers,\n            method: response.change.type,\n          };\n\n          try {\n            if (CACHE) {\n              watchPayload = await CACHE.handleWatchChange(watchPayload);\n            }\n          } catch (err) {\n            error(err);\n            throw err;\n          }\n          if (callback) {\n            await callback(watchPayload);\n          }\n          return;\n        },\n      );\n    } else {\n      throw new Error(\"websocket is required to watch resource\");\n    }\n  }\n\n  // Construct the request object and catch any 401s (expired token)\n  async function _buildRequest({ method, url, path, headers, data, type }) {\n    if (!path && !url) {\n      throw new Error(\"Either path or url must be specified.\");\n    }\n    if (url) {\n      if (/^\\//.test(url)) {\n        url = domain + url;\n      } else if (url.indexOf(domain) !== 0) {\n        throw new Error(`'url' key must begin with the domain used to connect`);\n      }\n    }\n    method = method.toLowerCase();\n    let req = {\n      method,\n      url: url || DOMAIN + path,\n      headers: { authorization: \"Bearer \" + TOKEN },\n    };\n    if (/\\/$/.test(req.url)) {\n      req.url = req.url.slice(0, req.url.length - 1);\n    }\n\n    //handle headers\n    Object.keys(headers || {}).forEach(header => {\n      req.headers[header.toLowerCase()] = headers[header];\n    });\n\n    if (method === \"put\" || method === \"post\") {\n      req.headers[\"content-type\"] =\n        req.headers[\"content-type\"] || type || data._type;\n      req.data = data;\n    }\n\n    if (method === \"delete\") {\n      req.headers[\"content-type\"] = req.headers[\"content-type\"] || type;\n    }\n    req.requestStack = new Error().stack;\n    return req;\n  }\n\n  async function _sendRequest(req) {\n    try {\n      return REQUEST(req);\n    } catch (err) {\n      if (err && err.response.status === 401) {\n        //token has expired\n        await reconnect();\n        return REQUEST(req);\n      }\n      throw err;\n    }\n  }\n\n  async function _treeWalk(url, tree, data, obj, beforeCb, afterCb) {\n    var bef = beforeCb ? await beforeCb(url, tree, data, obj) : { data, obj };\n    data = bef.data;\n    obj = bef.obj;\n\n    info(\"mapping over data\", url);\n    return Promise.map(Object.keys(data || {}), async function(key) {\n      info(\"key is\", key);\n      info(typeof data[key], tree);\n      if (typeof data[key] === \"object\") {\n        var nextTree;\n        if (tree[key]) {\n          nextTree = tree[key];\n        } else if (tree[\"*\"]) {\n          nextTree = tree[\"*\"];\n\n          //Leave alone data for any keys that are not present in tree. Do not\n          //pursue these keys any further.\n        } else {\n          return;\n        }\n        info(\"next data\", data[key]);\n        var res = await _treeWalk(\n          url + \"/\" + key,\n          nextTree,\n          data[key],\n          obj,\n          beforeCb,\n          afterCb,\n        );\n        info(key, res);\n        data[key] = res.data;\n        obj = res.obj;\n      }\n      return;\n    }).then(async function() {\n      return afterCb ? await afterCb(url, tree, data, obj) : { data, obj };\n    });\n  }\n\n  // walk down the tree to\n  function _recursiveFilterChange(url, tree, data) {\n    //Filter at resource breaks\n    return Promise.map(Object.keys(data || {}), async function(key) {\n      if (data[key] && typeof data[key] === \"object\") {\n        if (tree[key]) {\n          var res = await _recursiveFilterChange(\n            url + \"/\" + key,\n            tree[key],\n            data[key],\n          );\n          return (data[key] = res.data);\n        } else if (tree[\"*\"]) {\n          var res = await _recursiveFilterChange(\n            url + \"/\" + key,\n            tree[\"*\"],\n            data[key],\n          );\n          return (data[key] = res.data);\n        } else if (data[key]._id) {\n          let rv = data[key]._rev ? data[key]._rev : false;\n          data[key] = { _id: data[key]._id };\n          if (rv) {\n            data[key]._rev = data[key]._rev;\n          }\n          return;\n        }\n      } else {\n        return;\n      }\n    }).then(() => {\n      return { data };\n    });\n  }\n\n  //TODO: patched up uncaughtrejection warning on _sendRequest with try/catch\n  //but need to reevaluate better code structuring\n  async function get({ url, path, headers, watch, tree }) {\n    let req = await _buildRequest({ method: \"get\", url, path, headers });\n    // If a tree is supplied, recursively GET data according to the data tree\n    // The tree must be rooted at /bookmarks.\n\n    let watchResponse;\n    // TODO: shouldn't request twice for normal tree get...\n    var response = await _sendRequest(req);\n\n    let subTree;\n    // Use the tree to construct the subTree to be potentially used in both the\n    // watch as well as the recursiveGet\n    if (tree) {\n      let pieces = urlLib\n        .parse(req.url)\n        .path.replace(/^\\//, \"\")\n        .split(\"/\");\n      let treePath = _convertSetupTreePath(pieces, tree);\n      info(tree, treePath);\n      if (!pointer.has(tree, treePath)) {\n        throw new Error(\"The path does not exist on the given tree.\");\n      }\n      subTree = pointer.get(tree, treePath);\n    }\n\n    // Watch a resource; if a tree is also supplied, attach this to the payload\n    // so that change notifications can be filtered through the tree\n    if (watch) {\n      path = path || urlLib.parse(url).path;\n      req.headers[\"x-oada-rev\"] = response.data._rev;\n\n      info(\"Setting watch. Sending rev:\", response.data._rev);\n      if (tree) {\n        if (!watch.payload) watch.payload = {};\n        watch.payload.tree = subTree;\n      }\n\n      // Deprecation warnings\n      if (watch.function || watch.func) {\n        error(\"Deprecation warning: use callback to pass a watch handler.\");\n      }\n\n      let callback = watch.callback || watch.function || watch.func;\n      if (!callback) {\n        // Just a warning message. It doesn't throw but print an error message.\n        error(\"Warning: no watch handler was provided.\");\n      }\n\n      watchResponse = await _watch({\n        headers: req.headers,\n        path,\n        callback,\n        payload: watch.payload\n      });\n      info(\"WATCH RESPONSE\", watchResponse);\n    }\n\n    // Perform recursive GET in response to the tree\n    if (tree) {\n      try {\n        if (watch && watchResponse.resource) {\n          var dataOut = await _recursiveGet(req.url, subTree, watchResponse.resource, true);\n          error(\"tree getting\", watch, watchResponse.resource);\n          var dataOut = await _recursiveGet(\n            req.url,\n            subTree,\n            watchResponse.resource,\n            true,\n          );\n        } else {\n          var dataOut = await _recursiveGet(req.url, subTree, response.data, true);\n        }\n        response.data = dataOut.data;\n        response.cached = dataOut.cached;\n      } catch (err) { // catch 404s because ... ?\n        if (err.response && err.response.status === 404) {\n          error(\"Received 404\");\n        } else throw err;\n      }\n    }\n    return response;\n  } //get\n\n  async function _recursiveGet(url, tree, data, cached) {\n    // Perform a GET if we have reached the next resource break.\n    if (tree._type) {\n      // its a resource\n      let response = await get({\n        url,\n        headers: \"_rev\" in data ? { \"x-oada-rev\": data._rev } : {},\n      });\n      data = response.data;\n      cached = response.cached ? response.cached && cached : false;\n    }\n\n    return Promise.map(Object.keys(data || {}), async function(key) {\n      if (typeof data[key] === \"object\") {\n        if (tree[key]) {\n          let res = await _recursiveGet(\n            url + \"/\" + key,\n            tree[key],\n            data[key],\n            cached,\n          );\n          cached = cached && res.cached;\n          return (data[key] = res.data);\n        } else if (tree[\"*\"]) {\n          let res = await _recursiveGet(\n            url + \"/\" + key,\n            tree[\"*\"],\n            data[key],\n            cached,\n          );\n          cached = cached && res.cached;\n          return (data[key] = res.data);\n        } else {\n          return;\n        } //data[key] is already stored in the data object\n      } else {\n        return;\n      }\n    }).then(() => {\n      return { data, cached };\n    });\n  }\n\n  // Identify the stored resources vs those that need to be setup.\n  function _findDeepestResources(pieces, tree, storedTree) {\n    let stored = 0;\n    let setup;\n    var _rev;\n    // Walk down the url in reverse order\n    return Promise.mapSeries(pieces, (piece, i) => {\n      let z = pieces.length - 1 - i; //use z to create paths in reverse order\n      let urlPath = \"/\" + pieces.slice(0, z + 1).join(\"/\");\n      let treePath = _convertSetupTreePath(pieces.slice(0, z + 1), tree);\n      // Check that its in the stored tree then look for deepest _resource_.\n      // If successful, break from the loop by throwing\n      if (pointer.has(tree, treePath + \"/_type\")) {\n        setup = setup || z;\n        if (pointer.has(storedTree, urlPath)) {\n          stored = _.clone(z);\n          throw new Error(\"stored\");\n        }\n        return get({\n          path: urlPath,\n        })\n          .then(response => {\n            //TODO: Detect whether the returned data matches the given tree\n            pointer.set(storedTree, urlPath, {});\n            stored = _.clone(z);\n            _rev = response.headers[\"x-oada-rev\"];\n            throw new Error(\"stored\");\n          })\n          .catch(err => {\n            if (/^stored/.test(err.message)) {\n              throw err;\n            }\n            return;\n          });\n      } else {\n        return;\n      }\n    })\n      .catch(err => {\n        // Throwing with a number error only should occur on success.\n        if (/^stored/.test(err.message)) {\n          return { stored, setup };\n        }\n      })\n      .then(() => {\n        return {\n          stored: stored,\n          setup: setup || 0,\n          _rev,\n        };\n      });\n  }\n\n  // Loop over the keys of the path and determine whether the object at that level\n  // contains a * key. The path must be updated along the way, replacing *s as\n  // necessary.\n  function _convertSetupTreePath(pathPieces, tree) {\n    let newPieces = _.clone(pathPieces);\n    newPieces = pathPieces.map((piece, i) => {\n      if (pointer.has(tree, \"/\" + newPieces.slice(0, i).join(\"/\") + \"/*\")) {\n        newPieces[i] = \"*\";\n        return \"*\";\n      } else {\n        return piece;\n      }\n    });\n    return \"/\" + newPieces.join(\"/\");\n  }\n\n  // Walk down the given path using the tree as a guide to create the necessary\n  // resource breaks along the way.\n  async function _ensureTree({ url, tree, data }) {\n    let path = urlLib.parse(url).path.replace(/^\\//, \"\");\n    let pieces = path.replace(/\\/$/, \"\").split(\"/\"); // replace trailing slashes\n    if (data._id) {\n      let firstPath = _convertSetupTreePath(pieces, tree);\n      pointer.set(tree, firstPath + \"/_id\", data._id);\n    }\n    //    if (pointer.has(tree, treePath)) pointer.set(tree, treePath, _.merge(pointer.get(tree, treePath),data))\n    let storedTree = {};\n    var responses = [];\n    // Find the deepest part of the path that exists. Once found, work back down.\n    var ret = await _findDeepestResources(pieces, tree, storedTree);\n    // Create all the resources on the way down. ret.stored is an index. Slice\n    // takes the length to slice, so no need to subtract 1.\n    var parentRev = ret._rev;\n    await Promise.mapSeries(\n      pieces.slice(0, pieces.length - ret.stored),\n      async function(piece, j) {\n        let i = ret.stored + 1 + j;\n        let urlPath = \"/\" + pieces.slice(0, i + 1).join(\"/\");\n        let treePath = _convertSetupTreePath(pieces.slice(0, i + 1), tree);\n        if (pointer.has(tree, treePath + \"/_type\") && i <= ret.setup) {\n          // its a resource\n          var content = await _replaceLinks(pointer.get(tree, treePath));\n          var resp = await _makeResourceAndLink({\n            path: urlPath,\n            data: _.cloneDeep(content),\n            headers: { \"if-match\": parentRev },\n          });\n          parentRev = resp.resource.headers[\"x-oada-rev\"];\n          pointer.set(storedTree, urlPath, content);\n          resp.path = urlPath;\n          responses.push(resp);\n        }\n      },\n    );\n    return responses;\n  }\n\n  function _configureCache({ name, req, expires }) {\n    let res = setupCache({ name, req, expires, dbprefix });\n    REQUEST = res.api;\n    CACHE = res;\n    return;\n  }\n\n  function post({ url, path, data, type, headers, tree }) {\n    url = url || DOMAIN + path;\n    url = url[url.length - 1] === \"/\" ? url + uuid() : url + \"/\" + uuid();\n    return put({\n      url,\n      data,\n      type,\n      headers,\n      tree,\n    });\n  }\n\n  async function _recursiveDelete(url, tree, data) {\n    // Perform a GET if we have reached the next resource break.\n    if (tree._type) {\n      // its a resource\n      try {\n        var got = await get({\n          url,\n        });\n        data = got.data;\n      } catch (err) {\n        if (err.status === 404) {\n          data = {};\n        //  return;\n        }\n      }\n    }\n    return Promise.map(Object.keys(data || {}), async function(key) {\n      if (typeof data[key] === \"object\") {\n        if (tree[key]) {\n          var res = await _recursiveDelete(\n            url + \"/\" + key,\n            tree[key],\n            data[key],\n          );\n          return (data[key] = res.data);\n        } else if (tree[\"*\"]) {\n          var res = await _recursiveDelete(\n            url + \"/\" + key,\n            tree[\"*\"],\n            data[key],\n          );\n          info('url', url)\n          info('recursiveDelete. returning', res.data)\n          return (data[key] = res.data);\n        } else {\n          return;\n        } //data[key] is already stored in the data object\n      } else {\n        return;\n      }\n    }).then(async function() {\n      var link;\n      if (tree._type) {\n        try {\n          // Delete the resource\n          if (data._id) {\n            try {\n              await del({\n                path: \"/\" + data._id,\n                headers: { \"content-type\": tree._type },\n              });\n            } catch (erro) {\n              error(\"aaaaaaaa\", \"/\" + data._id, url, erro);\n              throw erro;\n            }\n          }\n\n          // Delete the link\n          link = await del({\n            url,\n            headers: {\n              \"content-type\": tree._type,\n            },\n          });\n        } catch (err) {\n          if (err.response && err.response.status === 404) {\n            data = {};\n            return {\n              link: link || {},\n              data: data || {},\n            };\n          }\n          throw err;\n        }\n      } else {\n        // Delete the lookup for non resources\n        if (CACHE) {\n          await CACHE.removeLookup({ url });\n        }\n      }\n      // link and data can be undefined if the current object is\n      // not a resource (deletes won't need to happen)\n      return {\n        link: link || {},\n        data: data || {},\n      };\n    })\n  }\n\n  async function del({ url, path, type, headers, tree, unwatch }) {\n    let req = await _buildRequest({\n      method: \"delete\",\n      url,\n      path,\n      type,\n      headers,\n    });\n    if (unwatch) {\n      path = path || urlLib.parse(url).path;\n      return SOCKET.unwatch({\n        path,\n        headers: req.headers,\n      });\n    }\n    if (tree) {\n      var pieces = urlLib\n        .parse(req.url)\n        .path.replace(/^\\//, \"\")\n        .split(\"/\");\n      let treePath = _convertSetupTreePath(pieces, tree);\n      if (!pointer.has(tree, treePath)) {\n        throw new Error(\"The path does not exist on the given tree.\");\n      }\n      //return get({url: req.url})\n      var subTree = pointer.get(tree, treePath);\n      var result = await _recursiveDelete(req.url, subTree, {}, true);\n      return result.link;\n\n      //var treePath = _convertSetupTreePath(pieces, tree) + \"/_type\";\n      //if (!req.headers[\"content-type\"] && pointer.has(tree, treePath))\n      //  req.headers[\"content-type\"] = _.clone(pointer.get(tree, treePath));\n    }\n    if (!req.headers[\"content-type\"]) {\n      throw new Error(`content-type header must be specified.`);\n    }\n\n    return _sendRequest(req);\n  }\n\n  // Ensure all resources down to the deepest resource are created before\n  // performing a PUT.\n  async function put({ url, path, data, type, headers, tree }) {\n    let req = await _buildRequest({\n      method: \"put\",\n      url,\n      path,\n      data,\n      type,\n      headers,\n    });\n\n    // Ensure parent resources are created\n    if (tree) {\n      var responses = await _ensureTree({\n        url: req.url,\n        tree: _.cloneDeep(tree),\n        data,\n      });\n      var pieces =\n        responses.length > 0\n          ? responses[responses.length - 1].path.replace(/^\\//, \"\").split(\"/\")\n          : urlLib\n              .parse(req.url)\n              .path.replace(/^\\//, \"\")\n              .split(\"/\");\n\n      var treePath = _convertSetupTreePath(pieces, tree) + \"/_type\";\n      if (!req.headers[\"content-type\"] && pointer.has(tree, treePath)) {\n        req.headers[\"content-type\"] = _.clone(pointer.get(tree, treePath));\n      }\n    }\n\n    if (!req.headers[\"content-type\"]) {\n      throw new Error(`content-type header must be specified.`);\n      info('PUT - tree ensured. Executing PUT', req);\n    }\n    return _sendRequest(req).then(result => {\n      return result;\n    });\n  }\n\n  async function resetCache(name, expires) {\n    if (!CACHE) {\n      return;\n    }\n    await CACHE.resetCache();\n  }\n\n  async function disconnect() {\n    if (CACHE) {\n      await CACHE.db.close();\n    }\n    //if (CACHE) await CACHE.db.destroy();\n    if (SOCKET) {\n      SOCKET.close();\n    }\n    //if (_token.isSet()) {\n    _token.cleanUp();\n    //}\n  }\n\n  async function reconnect() {\n    // get a new token\n    TOKEN = await _token.renew();\n  }\n\n  // get a token\n  TOKEN = await _token.get();\n  if (!TOKEN) {\n    throw new Error(\"Unable to get token\");\n  }\n\n  // Setup websockets\n  if (websocket !== false) {\n    var socketApi = await ws(domain);\n    NOCACHEREQUEST = socketApi.http;\n    REQUEST = socketApi.http;\n    SOCKET = await socketApi;\n  }\n\n  //Setup the cache\n  if (cache !== false) {\n    await _configureCache({\n      name: NAME || uuid(),\n      req: REQUEST,\n      expires: EXPIRES,\n    });\n  }\n\n  function _getMemoryCache() {\n    if (CACHE) {\n      return CACHE._getMemoryCache();\n    } else {\n      return {};\n    }\n  }\n\n  return {\n    token: TOKEN,\n    cache: CACHE ? CACHE : false,\n    websocket: SOCKET ? SOCKET : false,\n    get,\n    put,\n    post,\n    delete: del,\n    resetCache,\n    disconnect,\n    reconnect,\n    _getMemoryCache,\n  };\n};\n\nmodule.exports = {\n  connect,\n  setDbPrefix,\n};\n","\"use strict\";\nconst cq = require(\"concurrent-queue\");\nconst Promise = require(\"bluebird\");\nlet PouchDB = require(\"pouchdb\");\nif (PouchDB.default) PouchDB = PouchDB.default;\nconst url = require(\"url\");\nconst _ = require(\"lodash\");\nconst pointer = require(\"json-pointer\");\nconst OFFLINE = false;\nconst REVLIMIT = 10;\nvar memoryCache = {};\nconst timeThreshold = 30000;\nconst cleanMemoryTimer = 10000;\nconst dbPutDelay = 5000; // 5 sec\nPromise.config({ cancellation: true });\n//PouchDB.setMaxListeners(30);\n\n// debug\nconst error = require(\"debug\")(\"oada-cache:cache:error\");\nconst info = require(\"debug\")(\"oada-cache:cache:info\");\n\nmodule.exports = function setupCache({ name, req, expires, dbprefix }) {\n  dbprefix = dbprefix || \"\";\n  name = dbprefix + name;\n  // name should be made unique across domains and users\n  var db = db || new PouchDB(name);\n  // This fixes concurrent accesses\n  PouchDB.on(\"destroyed\", async function(dbName) {\n    if (dbName === name) {\n      db = new PouchDB(name);\n    }\n  });\n  var request = req;\n  var expiration = expires || 1000 * 60 * 60 * 24 * 2; //(ms/s)*(s/min)*(min/hr)*(hr/days)*days\n\n  // Clean in-memory cache periodically\n  setInterval(cleanMemoryCache, cleanMemoryTimer);\n\n  function cleanMemoryCache() {\n    const now = Date.now();\n    var oldest = { key: undefined, time: now };\n    var deleteCount = 0;\n    Object.keys(memoryCache).forEach(key => {\n      if (\n        !memoryCache[key].putPending &&\n        now - memoryCache[key].access < timeThreshold\n      ) {\n        if (memoryCache[key].access < oldest) {\n          oldest = { key, time: memoryCache[key].access };\n        }\n        delete memoryCache[key];\n        info(\"Deleted expired resource from the in-memory cache\", key);\n        deleteCount++;\n      }\n    });\n\n    if (deleteCount === 0 && oldest.key) {\n      delete memoryCache[oldest.key];\n    }\n  }\n\n  /** Save resource to in-memory cache and schedule PUT */\n  function handleMemoryCache(resourceId, data, waitTime, req) {\n    const now = Date.now();\n    if (resourceId in memoryCache) {\n      // resource exists in in-cache memory\n      // update data and access time\n      memoryCache[resourceId].data = data;\n      memoryCache[resourceId].access = now;\n      memoryCache[resourceId].valid = true;\n    } else {\n      // resource does not exist\n      // add new resource\n      memoryCache[resourceId] = {\n        data,\n        access: now,\n        promise: undefined,\n        putPending: false,\n        valid: true,\n      };\n    }\n\n    // Schedule db.put\n    if (!memoryCache[resourceId].putPending) {\n      // set flag\n      memoryCache[resourceId].putPending = true;\n      // Schedule put\n      memoryCache[resourceId].promise = Promise.delay(dbPutDelay)\n        .then(async function() {\n          if (!(resourceId in memoryCache)) {\n            throw new Error(\"Resource does not exist in the in-memory cache.\");\n          }\n          await doPut(resourceId, waitTime, req);\n          memoryCache[resourceId].putPending = false;\n        })\n        .catch(function(err) {\n          error(\"handleMemoryCacheError\", err);\n          memoryCache[resourceId].putPending = false;\n          throw err;\n        });\n    }\n    return Promise.resolve();\n  }\n\n  /**  Get resource from in-memory cache and do put to Pouch DB */\n  function doPut(resourceId, waitTime, req) {\n    if (!memoryCache[resourceId].data.doc) return\n    return db\n      .put(memoryCache[resourceId].data)\n      .then(response => {\n        memoryCache[resourceId].data._rev = response.rev;\n        delete memoryCache[resourceId].promise;\n      })\n      .catch(err => {\n        error(\"Error doPut\", memoryCache[resourceId].data._rev, err);\n        // TODO: Handle this error\n        // retry 409s\n        // if (err.status === 409) {\n        //   waitTime = waitTime || 1000;\n        //   return Promise.delay(waitTime).then(() => {\n        //     if (waitTime > 16000) throw err;\n        //     return dbUpsert(req, waitTime * 2);\n        //   });\n        // }\n        //throw err;\n      });\n  }\n\n  /** Get the resource and merge data if its already in the db. */\n\n  /**\n   * Store (upsert) resource to local DB\n   * @param req request\n   * @param waitTime wait time\n   */\n  async function dbUpsert(req, waitTime) {\n    var urlObj = url.parse(req.url);\n    var pieces = urlObj.path.split(\"/\");\n    var resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n    var pathLeftover =\n      pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\";\n\n    // Create the content to put in the cache\n    var dbPut = {\n      _id: resourceId,\n      valid: req.valid === undefined ? true : req.valid,\n      // TODO: This current resets this access date for e.g., every put\n      // while offline. This doesn't seem right. I think this should only\n      // get updated when we know we're upserting a new value from the server\n      accessed: Date.now(),\n      doc: {},\n    };\n\n    // ALL updates to existing docs (upserts) need to supply the current _rev.\n    let memoryResult = memoryCache[resourceId]; // Try to get resource from in-memory cache\n    let result = { doc: {} };\n\n    if (!memoryResult || !memoryResult.valid) {\n      // resource does not exist in memory; get from DB\n      try {\n        result = await db.get(resourceId);\n      } catch (e) {\n        // Else, the resource was not in the cache. This was the first put.\n        if (req.method && req.method.toLowerCase() === \"delete\") {\n          // Deleting a resource that doesn't exist: do nothing.\n          return;\n        } else if (pathLeftover) {\n          dbPut.INCOMPLETE_RESOURCE = true;\n        }\n      }\n    } else {\n      result = memoryResult.data;\n      // If in memory, result._rev might be undefined (409 errors)\n      if (result._rev !== undefined) {\n        dbPut._rev = result._rev;\n      }\n    }\n\n    // Now handle the upsert\n    if (req.method && req.method.toLowerCase() === \"delete\") {\n      if (!pathLeftover) {\n        if (memoryCache[resourceId] && memoryCache[resourceId].promise) {\n          memoryCache[resourceId].promise.cancel();\n        }\n        delete memoryCache[resourceId];\n        return db\n          .remove(result)\n          .then(response => {\n            return { response };\n          })\n          .catch(err => {\n            //its okay if it already doesn't exist\n            if (err.status === 404) {\n              return;\n            }\n            throw err;\n          });\n      } else {\n        if (pointer.has(result.doc, pathLeftover)) {\n          dbPut.doc = result.doc;\n          pointer.remove(dbPut.doc, pathLeftover);\n        }\n      }\n    } else {\n      //handle \"merge\" type operations\n      if (pathLeftover) {\n        var curData = pointer.has(result.doc, pathLeftover)\n          ? pointer.get(result.doc, pathLeftover)\n          : {};\n        var newData = _.merge(curData, req.data || {});\n        pointer.set(result.doc, pathLeftover, newData);\n        dbPut.doc = result.doc;\n      } else {\n        dbPut.doc = _.merge(result.doc, req.data);\n      }\n    }\n\n    if (req._rev != undefined) {\n      dbPut.doc._rev = req._rev;\n    }\n    return handleMemoryCache(resourceId, dbPut, waitTime, req);\n  }\n\n  /**\n   * Get resource from the server\n   * @param req request\n   */\n  async function getResFromServer(req) {\n    var res = await request({\n      method: \"GET\",\n      url: req.url,\n      headers: req.headers,\n    });\n    res.cached = false;\n    req.data = res.data;\n    await dbUpsert(req);\n    return res;\n  }\n\n  function _getMemoryCache() {\n    return memoryCache;\n  }\n\n  // Perform lookup from bookmarks to resource id (and path leftover) mapping.\n  // If the lookup fails, use a HEAD request to get it from the server and put\n  // it in the cache. An optional _id can be passed into req to force creation\n  // of a particular lookup in the event that the resource doesn't yet exist but will.\n  // This is primarily for when links are created before the resource itself has been.\n  function getLookup(req) {\n    var urlObj = url.parse(req.url);\n    var res_inmemory = memoryCache[urlObj.path];\n    if (res_inmemory) {\n      return res_inmemory.data;\n    } else {\n      // not in memory\n      return db.get(urlObj.path).catch(async function() {\n        //Not found. Go to the oada server, get the associated resource and path\n        //leftover, and save the lookup.\n        var resourceId;\n        var pathLeftover;\n        // _id passed in with request object; special case of recursiveUpsert\n        if (req.resourceId) {\n          resourceId = req.resourceId;\n          pathLeftover = \"\";\n        } else { // normal case, not recursiveUpsert\n          //info('getLookup - HEAD request:', req.url, req)\n          var headReq = _.cloneDeep(req)\n          headReq.method = \"HEAD\";\n          var response = await request(headReq);\n          //info('getLookup - HEAD response:', response)\n          //Save the url lookup for future use\n          var pieces = response.headers[\"content-location\"].split(\"/\");\n          resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n          pathLeftover =\n            pieces.length > 3\n              ? \"/\" + pieces.slice(3, pieces.length).join(\"/\")\n              : \"\";\n        }\n        // Put the new lookup\n        var data = {\n          _id: urlObj.path,\n          resourceId,\n          pathLeftover,\n        };\n        return handleMemoryCache(urlObj.path, data, undefined, req).then(() => {\n          return getLookup(req);\n        });\n      });\n    }\n  }\n\n  // Create a queue of actual PUTs to make when online.\n  // Resource breaks are known via setupTree.\n  // Do the puts, save out the resource IDs, and return to client\n  // Create an index on the data to find those that need synced\n\n  // Create a service that other apps can run which starts up and periodically\n  // checks if a connections has yet been made. A periodic service may also\n  // concievably check for updates to cached things.\n  //\n  // The cache should go \"stale\" after some period of time; However, if it cannot\n  // establish a connection, it should remain valid, usable data.\n\n  /**\n   * Get resource from local DB. If the specified resource does not exist, try to get it from the server.\n   * @param {any} req request\n   * @param {any} offline default is false (online)\n   */\n  async function getResFromDb(req, offline = false, revLimit) {\n    var urlObj = url.parse(req.url);\n    var pieces = urlObj.path.split(\"/\");\n    var resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n    var pathLeftover =\n      pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\";\n    var resource = undefined;\n    var rev = undefined;\n    // 1) Get resource from in-memory cache\n    var res_inmemory = memoryCache[resourceId];\n    if (res_inmemory && res_inmemory.valid) {\n      resource = res_inmemory.data;\n      info(`Returning the resource [${resourceId}] from in-memory cache.`);\n    }\n\n    // 2) Get resource from local DB\n    if (!resource) {\n      try {\n        let res_localdb = await db.get(resourceId);\n        /*\n        if (!res_localdb.valid) {\n          throw new Error(\"Invalid\");\n        }\n        */\n        resource = res_localdb;\n        info(`Returning the resource [${resourceId}] from PouchDB.`);\n        // Save the data to in-memory cache\n        const now = Date.now();\n        memoryCache[resourceId] = {\n          data: resource,\n          access: now,\n          promise: undefined,\n          putPending: false,\n          valid: resource.valid,\n        };\n      } catch (err) {\n        if (err.status === 404) {\n          error(\"Failed to get resource from PouchDB\", err);\n        } else throw err;\n      }\n    }\n\n    // 3) get resource from the server\n    if (!resource && !offline) {\n      info(`Returning the resource [${resourceId}] from the remote server.`);\n      return getResFromServer(req);\n    } else if (!resource && offline) {\n      throw `Offline and resource [${resourceId}] not found in local db.`;\n    }\n\n    // Check if the resource is still valid\n    if (\n      resource.accessed + expiration <= Date.now() ||\n      resource.valid === false\n    ) {\n      if (offline) {\n        // offline. skip for now. TODO: add code later\n        throw new Error(\n          \"Cached resource is expired or invalid and unable to fetch from the remote server.\",\n        );\n      } else {\n        info(\n          `Resource is expired or invalid. Returning the resource [${resourceId}] from the remote server.`,\n        );\n        return getResFromServer(req);\n      }\n    }\n\n    //Handle _rev passed in. If current object is too far out of date, get from server\n    if (\n      req.headers &&\n      req.headers[\"x-oada-rev\"] &&\n      parseInt(req.headers[\"x-oada-rev\"]) - parseInt(resource.doc._rev) >=\n        revLimit\n    ) {\n      return getResFromServer(req);\n    }\n\n    //If no pathLeftover, it'll just return resource!\n    if (pointer.has(resource.doc, pathLeftover)) {\n      var data = pointer.get(resource.doc, pathLeftover);\n      return {\n        data,\n        headers: {\n          \"x-oada-rev\": resource.doc._rev,\n          \"content-location\": resourceId + pathLeftover,\n        },\n        status: 200,\n        cached: true,\n      };\n    } else {\n      return getResFromServer(req);\n    }\n  }\n\n  // Accepts an axios-style request. Returns:\n  // {\n  //\n  //   data: the data requested,\n  //\n  //   _rev: the rev of the parent resource requested\n  //\n  //   location: e.g.: /resources/abc123/some/path/leftover\n  //\n  // }\n  async function get(req, revLimit) {\n    var urlObj = url.parse(req.url);\n    var newReq = _.cloneDeep(req);\n    if (!/^\\/resources/.test(urlObj.path) || !/^\\/users/.test(urlObj.path)) {\n      // First lookup the resourceId in the cache\n      var lookup = await getLookup(req);\n      newReq.url =\n        urlObj.protocol +\n        \"//\" +\n        urlObj.host +\n        \"/\" +\n        lookup.resourceId +\n        lookup.pathLeftover;\n    }\n    return getResFromDb(newReq, OFFLINE, revLimit || REVLIMIT).then(\n      response => {\n        return response;\n      },\n    );\n  }\n\n  // TODO: Need to update the cache for both the parent resource and child new\n  // resource if one is created\n  async function put(req, offline = false) {\n    let urlObj = url.parse(req.url);\n    if (offline) {\n      //TODO:\n      // 1) get the lookup\n      // 2) store the last known online record\n      // 3) store the change request into an array of offlineChanges\n      // 4) update the cache (but dirty it)\n      var lookup = await getLookup({\n        url:\n          urlObj.protocol +\n          \"//\" +\n          urlObj.host +\n          reqPieces.slice(0, reqPieces.length - 1).join(\"/\"),\n        headers: req.headers,\n      });\n    } else {\n      var response = await request(req);\n\n      // Invalidate the resource in the cache (if it is cached)\n      await dbUpsert({\n        url: response.headers[\"content-location\"],\n        data: req.data,\n        _rev: parseInt(response.headers[\"x-oada-rev\"]),\n        // TODO: should it be invalidated until pulled from server?\n        valid: false,\n      });\n      // Invalidate in-memory cache\n      if (req.data && req.data._id && memoryCache[req.data._id]) {\n        memoryCache[req.data._id].valid = false;\n      }\n\n      return response;\n    }\n  }\n\n  // Remove the deleted key from the parent resource optimistically using\n  // put(). Also mark the parent invalid as the _rev update will affect it\n  async function updateParent(req) {\n    var urlObj = url.parse(req.url);\n    // Try to get the parent document\n    var reqPieces = urlObj.path.split(\"/\");\n    var lookup = await getLookup({\n      url:\n        urlObj.protocol +\n        \"//\" +\n        urlObj.host +\n        reqPieces.slice(0, reqPieces.length - 1).join(\"/\"),\n      headers: req.headers,\n    });\n    try {\n    await dbUpsert({\n      url:\n        \"/\" +\n        lookup.resourceId +\n        lookup.pathLeftover +\n        \"/\" +\n        reqPieces[reqPieces.length - 1],\n      method: \"delete\",\n      valid: false,\n    });\n    } catch (err) {\n      throw err;\n    }\n    return;\n  }\n\n  async function removeLookup(lookup) {\n    // Clear the in-memory cache\n    if (memoryCache[lookup._id]) {\n      if (memoryCache[lookup._id].promise) {\n        memoryCache[lookup._id].promise.cancel();\n      }\n      delete memoryCache[lookup._id];\n    }\n\n    try {\n      await db.remove(lookup);\n    } catch (err) {\n      if (err.status === 404) {\n        return; // Delete something thats already gone; no problem\n      } else throw err;\n    }\n  }\n\n  // Issue DELETE to server then update the db\n  async function del(req, offline) {\n    var urlObj = url.parse(req.url);\n    // Handle resource deletion\n    if (/^\\/resources/.test(urlObj.path) || /^\\/users/.test(urlObj.path)) {\n      // Submit a dbUpsert to either remove the whole cache document or else\n      // a key within a document\n      await dbUpsert({\n        url: req.url,\n        method: req.method,\n        valid: false,\n      });\n    } else {\n      var lookup;\n      try {\n        lookup = await getLookup(req);\n\n        if (lookup.pathLeftover) { // delete inside of a resource: update the document\n          await dbUpsert({\n            url: \"/\" + lookup.resourceId + lookup.pathLeftover,\n            method: req.method,\n            valid: false,\n          });\n        } else await updateParent(req); // Deleting a link: update the parent\n        await removeLookup(lookup);\n      } catch (err) {\n        if (err.response.status !== 404) throw err;\n      }\n    }\n\n    // Execute the request if we're online, else queue it up\n    var response;\n    if (!offline) {\n      response = await request(req);\n    }\n    return response;\n  }\n\n  function replaceLinks(obj, req) {\n    let ret = Array.isArray(obj) ? [] : {};\n    if (!obj) {\n      return obj;\n    }\n    Object.keys(obj || {}).forEach(async function(key, i) {\n      let val = obj[key];\n      if (typeof val !== \"object\" || !val) {\n        ret[key] = val; // keep it asntType: 'application/vnd.oada.harvest.1+json'\n        return;\n      }\n      if (val._meta) {\n        // If has a '_rev' (i.e, resource), make it a link\n        let lookup = await getLookup({\n          url: req.url + \"/\" + key,\n          headers: req.headers,\n        });\n        ret[key] = { _id: lookup.resourceId };\n        if (obj[key]._rev !== undefined) {\n          ret[key]._rev = obj[key]._rev;\n        }\n        return;\n      }\n      ret[key] = replaceLinks(obj[key], {\n        url: req.url + \"/\" + key,\n        headers: req.headers,\n      }); // otherwise, recurse into the object\n    });\n    return ret;\n  }\n\n  async function _recursiveUpsert(req, body) {\n    if (body._rev !== undefined) {\n      let lookup = await getLookup({\n        url: req.url,\n        headers: req.headers,\n        resourceId: body._id,\n      });\n      let newBody = replaceLinks(body, {\n        url: req.url,\n        headers: req.headers,\n      });\n\n      await dbUpsert({\n        url: \"/\" + (body._id || lookup.resourceId),\n        data: newBody,\n      });\n    }\n\n    if (typeof body === \"object\") {\n      return Promise.map(Object.keys(body || {}), async function(key) {\n        if (key.charAt(0) === \"_\") {\n          return;\n        }\n        if (!body[key]) {\n          return;\n        }\n        await _recursiveUpsert(\n          {\n            url: req.url + \"/\" + key,\n            headers: req.headers,\n          },\n          body[key],\n        );\n      });\n    } else {\n      return;\n    }\n  }\n\n  function findNullValue(obj, path, nullPath) {\n    if (typeof obj === \"object\") {\n      return Promise.map(\n        Object.keys(obj || {}),\n        key => {\n          if (obj[key] === null) {\n            nullPath = path + \"/\" + key;\n            return nullPath;\n          }\n          return findNullValue(obj[key], path + \"/\" + key, nullPath).then(\n            res => {\n              nullPath = res || nullPath;\n              return res || nullPath;\n            },\n          );\n        },\n        { concurrency: 1 },\n      ).then(() => {\n        return nullPath;\n      })\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  /*\n  async function _upsertChangeArray(payload) {\n    let urlObj = url.parse(payload.request.url);\n    return Promise.map(payload.response.changes || [], async (change) => {\n      if (change.type === 'merge') {\n        return dbUpsert({\n          url: urlObj.protocol+'//'+urlObj.host+'/'+change._id,\n          data: change.body,\n        })\n      } else if (change.type === 'delete') {\n        var nullPath = await findNullValue(change.body, '', '')\n        return dbUpsert({\n          url: urlObj.protocol+'//'+urlObj.host+'/'+change._id+nullPath,\n          data: change.body,\n        })\n      }\n    })\n  }\n\t*/\n\n  // Will this handle watches put on keys of a resource? i.e., no _id to be found\n  function findDeepestResource(obj, path, deepestResource) {\n    if (typeof obj === \"object\") {\n      return Promise.map(Object.keys(obj || {}), key => {\n        // _rev updates guaranteed to be present in change docs for affected resources\n        if (key === \"_rev\") {\n          deepestResource.path = path;\n          deepestResource.data = obj;\n        } else if (key.charAt(0) === \"_\") {\n          return deepestResource;\n        }\n        return findDeepestResource(\n          obj[key],\n          path + \"/\" + key,\n          deepestResource,\n        ).then(() => {\n          return deepestResource;\n        });\n      }).then(() => {\n        return deepestResource;\n      });\n    }\n    return Promise.resolve(deepestResource);\n  }\n\n  var queue = cq()\n    .limit({ concurrency: 1 })\n    .process(async function(payload) {\n      let urlObj = url.parse(payload.request.url);\n      // Give the change body an _id so the deepest resource can be found\n      payload.response.change.body = payload.response.change.body || {};\n      payload.response.change.body._id = payload.response.resourceId;\n      //TODO: This should be unnecessary. The payload ought to specify the root\n      //of the watch as a resource.\n      return findDeepestResource(payload.response.change.body, \"\", {\n        path: \"\",\n        data: payload.response.change.body,\n      })\n        .then(async deepestResource => {\n          if (payload.response.change.wasDelete) {\n            // DELETE: remove the deepest resource from the change body, execute\n            // the delete, and recursively update all other revs in the cache\n            let nullPath = await findNullValue(deepestResource.data, \"\", \"\");\n            let deletedPath = deepestResource.path + nullPath;\n            payload.nullPath = deletedPath;\n            return dbUpsert({\n              url: payload.request.url + deletedPath,\n              headers: payload.request.headers,\n              method: \"delete\",\n              valid: true,\n            }).then(async function() {\n              // Update revs on all parents all the way down to (BUT OMITTING) the\n              // resource on which the delete was called.\n              //pointer.remove(payload.response.change.body, deepestResource.path || '/')\n              //            await _recursiveUpsert(payload.request, payload.response.change.body)\n              return payload;\n            });\n          } else {\n            // Recursively update all of the resources down the returned change body\n            /*\n            var oldBody = await _recursiveUpsert(payload.request, payload.response.change.body, {})\n            payload.oldBody = oldBody;\n            return payload;\n            */\n            await _recursiveUpsert(\n              payload.request,\n              payload.response.change.body.data,\n            );\n            return payload;\n          }\n        })\n        .catch(err => {\n          return payload;\n        });\n    });\n\n  function handleWatchChange(payload) {\n    return queue(payload);\n  }\n\n  async function resetCache(name) {\n    if (db) {\n      Object.keys(memoryCache).forEach(async function(key) {\n        if (memoryCache[key].promise) {\n          await memoryCache[key].promise.cancel();\n        }\n      });\n      memoryCache = {};\n      await db.destroy();\n\n    }\n  }\n\n  let api = function handleRequest(req) {\n    switch (req.method) {\n      case \"get\":\n        return get(req);\n      case \"delete\":\n        return del(req);\n      case \"put\":\n        return put(req);\n      default:\n        throw new Error(\"Unknown request method.\");\n    }\n  };\n\n  return {\n    api,\n    db,\n    resetCache,\n    handleWatchChange,\n    removeLookup,\n    findDeepestResource,\n    findNullValue,\n    getLookup,\n    dbUpsert,\n    handleMemoryCache,\n    doPut,\n    _recursiveUpsert,\n    findNullValue,\n    replaceLinks,\n    updateParent,\n    getResFromDb,\n    getResFromServer,\n    _getMemoryCache,\n  };\n}\n","const Promise = require(\"bluebird\");\nconst urlLib = require(\"url\");\nconst uuid = require(\"uuid/v4\");\nconst WebSocket = require(\"isomorphic-ws\");\nPromise.config({ warnings: false });\n\nfunction websocket(url) {\n  //Create the message queue\n  var messages = [];\n  //Create the socket\n  url = url.replace(\"https://\", \"wss://\").replace(\"http://\", \"ws://\");\n  var socket = new WebSocket(url);\n  var connected = false;\n  var httpCallbacks = {};\n  var watchCallbacks = {};\n\n  function sendMessages() {\n    if (!connected) {\n      return;\n    }\n    messages.forEach(message => {\n      socket.send(JSON.stringify(message));\n    });\n    messages = [];\n  }\n\n  return new Promise((resolve, reject) => {\n    socket.onopen = function(event) {\n      connected = true;\n      sendMessages();\n      resolve(socket);\n    };\n\n    socket.oncloconsose = function(event) {};\n    socket.onmessage = function(event) {\n      var response = JSON.parse(event.data);\n      //Look for id in httpCallbacks\n      if (response.requestId) {\n        if (httpCallbacks[response.requestId]) {\n          //Resolve Promise\n          if (response.status >= 200 && response.status < 300) {\n            httpCallbacks[response.requestId].resolve(response);\n          } else {\n            //Create error like axios\n            let err = new Error(\n              \"Request failed with status code \" + response.status\n            );\n            err.request = httpCallbacks[response.requestId].request;\n            err.response = {\n              status: response.status,\n              statusText: response.statusText,\n              headers: response.headers,\n              data: response.data,\n            };\n            err.originalStack = httpCallbacks[response.requestId].request.requestStack;\n\n\t\t\t\t\t\thttpCallbacks[response.requestId].reject(err);\n\t\t\t\t\t}\n\t\t\t\t\tdelete httpCallbacks[response.requestId];\n        } else if (watchCallbacks[response.requestId]) {\n          if (watchCallbacks[response.requestId].resolve) {\n            if (response.status === \"success\") {\n              //Successfully setup websocket, resolve promise\n              watchCallbacks[response.requestId].resolve(response);\n            } else {\n              //error(watchCallbacks[response.requestId].request, response);\n              let err = new Error(\n                \"Request failed with status code \" + response.status\n              );\n              err.response = response;\n              err.request = watchCallbacks[response.requestId].request;\n              watchCallbacks[response.requestId].reject(err);\n            }\n            //Remove resolve and reject so we process change as a signal next time\n            delete watchCallbacks[response.requestId][\"resolve\"];\n            delete watchCallbacks[response.requestId][\"reject\"];\n          } else {\n            if (watchCallbacks[response.requestId].callback == null) {\n              throw new Error(\n                \"The given watch function has an undefined callback:\",\n                watchCallbacks[response.requestId]\n              );\n            }\n            watchCallbacks[response.requestId].callback(response);\n          }\n        }\n      }\n    };\n  }).then(() => {\n    function _http(request) {\n      //Do a HTTP request\n      return new Promise((resolve, reject) => {\n        let urlObj = urlLib.parse(request.url);\n        let message = {\n          requestId: uuid(),\n          method: request.method.toLowerCase(),\n          path: urlObj.path,\n          data: request.data,\n          headers: Object.entries(request.headers)\n            .map(([key, value]) => {\n              return { [key.toLowerCase()]: value };\n            })\n            .reduce((a, b) => {\n              return { ...a, ...b };\n            }),\n        };\n        messages.push(message);\n        httpCallbacks[message.requestId] = {\n          request: request,\n          resolve: resolve,\n          reject: reject,\n        };\n        sendMessages();\n      });\n    }\n\n    function _unwatch(request, callback) {\n      //Watch for changes on requested resource and trigger provided signal\n      return new Promise((resolve, reject) => {\n        let message = {\n          requestId: uuid(),\n          method: \"unwatch\",\n          path: request.path,\n          headers: Object.entries(request.headers)\n            .map(([key, value]) => {\n              return { [key.toLowerCase()]: value };\n            })\n            .reduce((a, b) => {\n              return { ...a, ...b };\n            }),\n        };\n        messages.push(message);\n        watchCallbacks[message.requestId] = {\n          request,\n          resolve,\n          reject,\n          callback,\n        };\n        sendMessages();\n      });\n    }\n\n    function _watch(request, callback) {\n      //Watch for changes on requested resource and trigger provided signal\n      return new Promise((resolve, reject) => {\n        let message = {\n          requestId: uuid(),\n          method: \"watch\",\n          path: request.path,\n          headers: Object.entries(request.headers)\n            .map(([key, value]) => {\n              return { [key.toLowerCase()]: value };\n            })\n            .reduce((a, b) => {\n              return { ...a, ...b };\n            }),\n        };\n        messages.push(message);\n        watchCallbacks[message.requestId] = {\n          request,\n          resolve,\n          reject,\n          callback,\n        };\n        sendMessages();\n      });\n    }\n\n    function _close() {\n      //TODO reject all callbacks that have not resolved\n      //Clear everything\n      messages = [];\n      httpCallbacks = {};\n      watchCallbacks = {};\n      //Close socket\n      socket.close();\n    }\n\n    return {\n      url,\n      http: _http,\n      close: _close,\n      watch: _watch,\n      unwatch: _unwatch,\n    };\n  });\n}\n\nmodule.exports = websocket;\n","\"use strict\";\n\n/* Copyright 2018 Open Ag Data Alliance\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @author Servio Palacios, Samuel Noel\n * Token API for Handling Tokens in the Cache Library - Super Class.\n * @module src/token\n */\n\nvar Promise = require(\"bluebird\");\nlet PouchDB = require(\"pouchdb\");\nif (PouchDB.default) PouchDB = PouchDB.default;\nconst { STATUS_CODE } = require(\"http\");\nconst urlLib = require(\"url\");\nconst _ = require(\"lodash\");\n//const debug = require(\"debug\")(\"oada-cache:token\");\nconst crypto = require(\"crypto\");\nconst oadaIdClient = require(\"@oada/oada-id-client\");\n//const error = require('debug')('oada-cache:index:error');\n//const info = require('debug')('oada-cache:index:info');\n\nclass Token {\n  constructor(param = {}) {\n    let self = this;\n    self._token = param.token || null;\n    self._domain = param.domain || \"localhost\";\n    self._options = param.options;\n    self._dbprefix = param.dbprefix || \"\";\n\n    // creating database nae based on the domain\n    // ensured one to one correspondence with the domain\n    // i.e., token belongs to that domain\n    const hash = crypto.createHash(\"sha256\");\n    hash.update(self._domain);\n    self._name = self._dbprefix + hash.digest(\"hex\");\n\n    self._isSet = self._token ? true : false;\n    self._tokenDB = new PouchDB(self._name);\n    self._id = \"OadaTokenID\";\n    self._rev = null;\n    self.token = self._token ? self._token : \"\";\n  } //constructor\n\n  /**\n   * searches for a local db and a doc\n   */\n  async checkTokenDB() {\n    let result = null;\n    try {\n      //getting the doc from the server if exists\n      let doc = await this._tokenDB.get(this._id);\n      //      debug(\"received document ->\", doc);\n      result = doc.token;\n      this._rev = doc._rev;\n    } catch (err) {\n      return result;\n    }\n    return result;\n  } //checkTokenDB\n\n  /**\n   * if token was provided then it sets the .token in the constructor -> returns that value\n   * sets the pouch db if it does not exist\n   */\n  async setup(_expired) {\n    // Get a token\n    let TOKEN = null; //returned to the chache library\n    if (this.isSet()) {\n      TOKEN = this.token;\n    } else {\n      // get token from local cache\n      TOKEN = await this.checkTokenDB();\n\n      if (!TOKEN || _expired) {\n        //local cache does not have a token\n        let urlObj = urlLib.parse(this._domain);\n        let result;\n        // Open the browser and the login popup\n        if (typeof window === \"undefined\") {\n          result = await oadaIdClient.node(urlObj.host, this._options);\n        } else {\n          // the library itself detects a browser environment and delivers .browser\n          var gat = Promise.promisify(oadaIdClient.getAccessToken);\n          result = await gat(urlObj.host, this._options);\n        }\n        TOKEN = result.access_token;\n        //        debug(\"setup token -> access token:\", result.access_token);\n        this.put(TOKEN);\n      } //if !TOKEN\n    } //else\n    return TOKEN;\n  } //setup\n\n  /**\n   * fetches the token from the this._tokenDB or\n   * setups the new database and retrieves the new token to be used\n   */\n  async get() {\n    return this.setup();\n  }\n\n  /**\n   * searches for the token in the this._tokenDB\n   * if present, the it sends the current _rev\n   * if not present (404), it creates a new document in the created this._tokenDB\n   * @param {string} _token\n   */\n  async put(_token) {\n    // get token from local cache\n    let TOKEN = this.checkTokenDB();\n    try {\n      if (TOKEN) {\n        //local cache has that token, use the _rev\n        let response = await this._tokenDB.put({\n          _id: this._id,\n          _rev: this._rev,\n          token: _token,\n        });\n        this.token = _token;\n      } else {\n        //not found\n        //        debug(\"not found -> creating one\");\n        let response = await this._tokenDB.put({\n          _id: this._id,\n          token: _token,\n        });\n        this.token = _token;\n      } //else\n    } catch (err) {\n      //error(\"Error: not found -> put\", err);\n    }\n  } //put\n\n  async renew() {\n    this._isSet = false;\n    return this.setup(true); //expired = true\n  }\n\n  async cleanUp() {\n    try {\n      await this._tokenDB.destroy();\n      //await this._tokenDB.close();\n      this._isSet = false;\n    } catch (err) {\n      //error(\"deleting token from cache\", err);\n    }\n  } //cleanUp\n\n  isSet() {\n    return this._isSet;\n  }\n} //class\n\n/* exporting the module */\nmodule.exports = Token;\n"],"sourceRoot":""}